<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Cloud Practitioner AI Exam Portal</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SVG Icons
        const Upload = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2 2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></svg>);
        const CheckCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></svg>);
        const XCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><line x1="15" y1="9" x2="9" y2="15" /><line x1="9" y1="9" x2="15" y2="15" /></svg>);
        const RotateCcw = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="1 4 1 10 7 10" /><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" /></svg>);
        const Download = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2 2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></svg>);
        const Clock = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></svg>);
        const Award = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7" /><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" /></svg>);
        const BookOpen = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></svg>);
        const Flag = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z" /><line x1="4" y1="22" x2="4" y2="15" /></svg>);
        const BarChart = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10" /><line x1="18" y1="20" x2="18" y2="4" /><line x1="6" y1="20" x2="6" y2="16" /></svg>);
        const Eye = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" /><circle cx="12" cy="12" r="3" /></svg>);
        const AlertCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></svg>);
        const User = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>);
        const Users = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M23 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></svg>);
        const FileText = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" /></svg>);
        const Database = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" /><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" /></svg>);
        const Trash = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /></svg>);
        const History = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v5h5" /><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8" /><path d="M12 7v5l4 2" /></svg>);
        const Brain = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-2.5 2.5h-2A2.5 2.5 0 0 1 5 19.5v-15A2.5 2.5 0 0 1 7.5 2h2Z" /><path d="M14.5 2A2.5 2.5 0 0 1 17 4.5v15a2.5 2.5 0 0 1-2.5 2.5h-2A2.5 2.5 0 0 1 10 19.5v-15A2.5 2.5 0 0 1 12.5 2h2Z" /></svg>);
        const Zap = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></svg>);
        const Target = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></svg>);

        // AWS Cloud Practitioner Domains
        const awsDomains = [
            {
                name: "Domain 1: Cloud Concepts (24%)",
                topics: [
                    "Pay-as-you-go pricing",
                    "Scalability and Elasticity", 
                    "High availability",
                    "Global reach (Regions/Availability Zones)",
                    "Agility",
                    "Cost savings (economies of scale)",
                    "Well-Architected Framework (6 Pillars)",
                    "Cloud Migration strategies",
                    "AWS CAF (Cloud Adoption Framework)",
                    "Cloud Economics (CapEx vs OpEx)",
                    "Rightsizing and managed services"
                ]
            },
            {
                name: "Domain 2: Security and Compliance (30%)",
                topics: [
                    "AWS Shared Responsibility Model",
                    "Security, Governance, Compliance",
                    "AWS Artifact and compliance programs",
                    "Logging (CloudTrail, CloudWatch)",
                    "Monitoring (Security Hub, GuardDuty)",
                    "Encryption (at rest & in transit)",
                    "Identity & Access Management (IAM)",
                    "Root user protection and MFA",
                    "IAM Identity Center (SSO)",
                    "Security Tools (WAF, Shield)",
                    "Network ACLs, Security Groups"
                ]
            },
            {
                name: "Domain 3: Cloud Technology and Services (34%)",
                topics: [
                    "Deployment & Operations",
                    "AWS Global Infrastructure",
                    "Compute Services (EC2, Lambda)",
                    "Database Services (RDS, DynamoDB)",
                    "Networking (VPC, Route 53)",
                    "Storage (S3, EBS, EFS)",
                    "AI/ML & Analytics services",
                    "Application Integration (SNS, SQS)",
                    "Developer Tools",
                    "IoT and other AWS services"
                ]
            },
            {
                name: "Domain 4: Billing, Pricing & Support (12%)",
                topics: [
                    "AWS Pricing Models",
                    "Cost Management Tools",
                    "AWS Budgets and Cost Explorer",
                    "Cost allocation tags",
                    "AWS Organizations",
                    "AWS Support Plans",
                    "Technical Resources",
                    "Trusted Advisor",
                    "AWS Health Dashboard"
                ]
            }
        ];

        const ExamSystem = () => {
            const [userRole, setUserRole] = useState(null);
            const [userName, setUserName] = useState('');
            const [questions, setQuestions] = useState([]);
            const [answers, setAnswers] = useState([]);
            const [userAnswers, setUserAnswers] = useState({});
            const [flaggedQuestions, setFlaggedQuestions] = useState(new Set());
            const [showResults, setShowResults] = useState(false);
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [timeLeft, setTimeLeft] = useState(9000);
            const [examStarted, setExamStarted] = useState(false);
            const [score, setScore] = useState(0);
            const [examHistory, setExamHistory] = useState([]);
            const [showStats, setShowStats] = useState(false);
            const [darkMode, setDarkMode] = useState(false);
            const [examTitle, setExamTitle] = useState('AWS Cloud Practitioner Exam');
            const [showReview, setShowReview] = useState(false);
            const [showConfirmSubmit, setShowConfirmSubmit] = useState(false);
            const [allStudents, setAllStudents] = useState([]);
            const [teacherView, setTeacherView] = useState('dashboard');
            const [selectedHistoryExam, setSelectedHistoryExam] = useState(null);
            const [selectedDomains, setSelectedDomains] = useState([]);
            const [questionCount, setQuestionCount] = useState(10);
            const [difficulty, setDifficulty] = useState('medium');
            const [generatingQuestions, setGeneratingQuestions] = useState(false);
            const [explanations, setExplanations] = useState({});
            const [showExplanation, setShowExplanation] = useState(false);
            const [currentExplanation, setCurrentExplanation] = useState(null);
            const [practiceMode, setPracticeMode] = useState(false);
            const [showDomainSelector, setShowDomainSelector] = useState(false);
            const [showQuestionGenerator, setShowQuestionGenerator] = useState(false);

            // Initialize JSON Storage
            useEffect(() => {
                loadAllStudents();
                if (userRole === 'student') {
                    loadStudentExamHistory();
                }
            }, [userRole]);

            // Load all students for teacher view
            const loadAllStudents = () => {
                try {
                    const storedData = localStorage.getItem('awsExamStudents');
                    if (storedData) {
                        const studentsData = JSON.parse(storedData);
                        setAllStudents(studentsData);
                    }
                } catch (error) {
                    console.error('Error loading students:', error);
                }
            };

            // Load student's exam history
            const loadStudentExamHistory = () => {
                if (!userName) return;

                try {
                    const storedData = localStorage.getItem('awsExamResults');
                    if (storedData) {
                        const allResults = JSON.parse(storedData);
                        const studentResults = allResults.filter(result => result.studentName === userName);
                        setExamHistory(studentResults);
                    }
                } catch (error) {
                    console.error('Error loading exam history:', error);
                }
            };

            // Save student to JSON storage
            const saveStudentToDatabase = (name, role) => {
                try {
                    const storedData = localStorage.getItem('awsExamStudents');
                    let students = storedData ? JSON.parse(storedData) : [];

                    // Check if student already exists
                    const existingStudentIndex = students.findIndex(s => s.name === name);

                    if (existingStudentIndex >= 0) {
                        // Update existing student
                        students[existingStudentIndex].role = role;
                        students[existingStudentIndex].updatedAt = new Date().toISOString();
                    } else {
                        // Add new student
                        students.push({
                            id: Date.now().toString(),
                            name: name,
                            role: role,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        });
                    }

                    localStorage.setItem('awsExamStudents', JSON.stringify(students));
                    setAllStudents(students);
                    return true;
                } catch (error) {
                    console.error('Error saving student:', error);
                    return false;
                }
            };

            // Save exam results to JSON storage
            const saveExamToDatabase = (examData) => {
                try {
                    const storedData = localStorage.getItem('awsExamResults');
                    let examResults = storedData ? JSON.parse(storedData) : [];

                    examResults.push({
                        id: Date.now().toString(),
                        studentName: examData.studentName,
                        examTitle: examData.examTitle,
                        score: examData.score,
                        totalQuestions: examData.total,
                        percentage: examData.percentage,
                        timeSpent: examData.timeSpent,
                        dateCreated: new Date().toISOString(),
                        questions: examData.questions,
                        answers: examData.answers,
                        userAnswers: examData.userAnswers
                    });

                    localStorage.setItem('awsExamResults', JSON.stringify(examResults));
                    console.log('Exam results saved to JSON storage');
                    loadStudentExamHistory();
                    loadAllStudents();
                } catch (error) {
                    console.error('Error saving exam results:', error);
                }
            };

            // Delete student and their data
            const deleteStudent = (studentName) => {
                try {
                    // Delete student from students list
                    const storedStudents = localStorage.getItem('awsExamStudents');
                    if (storedStudents) {
                        let students = JSON.parse(storedStudents);
                        students = students.filter(s => s.name !== studentName);
                        localStorage.setItem('awsExamStudents', JSON.stringify(students));
                        setAllStudents(students);
                    }

                    // Delete student's exam results
                    const storedResults = localStorage.getItem('awsExamResults');
                    if (storedResults) {
                        let examResults = JSON.parse(storedResults);
                        examResults = examResults.filter(result => result.studentName !== studentName);
                        localStorage.setItem('awsExamResults', JSON.stringify(examResults));
                    }

                    console.log(`Student ${studentName} deleted successfully`);
                } catch (error) {
                    console.error('Error deleting student:', error);
                }
            };

            // Delete specific exam result
            const deleteExamResult = (examId) => {
                try {
                    const storedResults = localStorage.getItem('awsExamResults');
                    if (storedResults) {
                        let examResults = JSON.parse(storedResults);
                        examResults = examResults.filter(result => result.id !== examId);
                        localStorage.setItem('awsExamResults', JSON.stringify(examResults));
                        loadStudentExamHistory();
                        loadAllStudents();
                        console.log('Exam result deleted successfully');
                    }
                } catch (error) {
                    console.error('Error deleting exam result:', error);
                }
            };

            // Load a previous exam attempt for review
            const loadPreviousExam = (examData) => {
                setQuestions(examData.questions);
                setAnswers(examData.answers);
                setUserAnswers(examData.userAnswers);
                setScore(examData.score);
                setExamTitle(`${examData.examTitle} (Previous Attempt)`);
                setShowResults(true);
                setShowStats(false);
                setSelectedHistoryExam(null);
            };

            // AI Question Generation
            const generateQuestionsWithAI = async (domains, count, difficulty, examType) => {
                setGeneratingQuestions(true);
                
                try {
                    // Extract topics from selected domains
                    const selectedTopics = domains.flatMap(domain => domain.topics);
                    
                    // Create a prompt for the AI
                    const prompt = `Generate ${count} multiple-choice questions for AWS Cloud Practitioner exam focusing on: ${selectedTopics.join(', ')}. 
                    Difficulty level: ${difficulty}. 
                    Format: Each question should have a question text and 4 options (A, B, C, D). 
                    Provide the correct answer for each question. 
                    Format the response as JSON: { "questions": [ { "question": "question text", "options": ["A. option1", "B. option2", "C. option3", "D. option4"], "answer": "A" } ] }`;
                    
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyCR5TIp-MG3WmAiHZkCPXrKvHVYAMjcsoU', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [
                                {
                                    parts: [
                                        {
                                            text: prompt
                                        }
                                    ]
                                }
                            ]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to generate questions');
                    }
                    
                    const data = await response.json();
                    
                    // Extract the generated text
                    const generatedText = data.candidates[0].content.parts[0].text;
                    
                    // Try to parse the JSON from the response
                    let jsonMatch = generatedText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const parsedData = JSON.parse(jsonMatch[0]);
                        
                        // Save questions to JSON file
                        saveQuestionsToJSON(parsedData.questions);
                        
                        // Set questions and answers
                        const newQuestions = parsedData.questions.map(q => ({
                            question: q.question,
                            options: q.options
                        }));
                        
                        const newAnswers = parsedData.questions.map(q => q.answer);
                        
                        setQuestions(newQuestions);
                        setAnswers(newAnswers);
                        
                        if (examType === 'domain') {
                            const domainNames = domains.map(d => d.name.split(':')[0]);
                            setExamTitle(`Domain Practice: ${domainNames.join(', ')}`);
                        } else if (examType === 'full') {
                            setExamTitle('Full Practice Exam (60 Questions)');
                        } else {
                            setExamTitle('AI Generated Practice Test');
                        }
                        
                        // Start the exam
                        setPracticeMode(true);
                        setExamStarted(true);
                        setTimeLeft(count * 90); // 1.5 minutes per question
                        setUserAnswers({});
                        setShowResults(false);
                        setCurrentQuestion(0);
                        setFlaggedQuestions(new Set());
                    } else {
                        // Fallback to sample questions if parsing fails
                        console.error('Failed to parse AI response, using sample questions');
                        generateSampleQuestions();
                    }
                } catch (error) {
                    console.error('Error generating questions with AI:', error);
                    // Fallback to sample questions
                    generateSampleQuestions();
                } finally {
                    setGeneratingQuestions(false);
                }
            };

            // Save questions to JSON file
            const saveQuestionsToJSON = (questions) => {
                try {
                    const storedQuestions = localStorage.getItem('awsExamQuestions');
                    let allQuestions = storedQuestions ? JSON.parse(storedQuestions) : [];
                    
                    // Add new questions
                    allQuestions = [...allQuestions, ...questions];
                    
                    localStorage.setItem('awsExamQuestions', JSON.stringify(allQuestions));
                    console.log('Questions saved to JSON storage');
                } catch (error) {
                    console.error('Error saving questions to JSON:', error);
                }
            };

            // Load questions from JSON file
            const loadQuestionsFromJSON = () => {
                try {
                    const storedQuestions = localStorage.getItem('awsExamQuestions');
                    if (storedQuestions) {
                        const allQuestions = JSON.parse(storedQuestions);
                        return allQuestions;
                    }
                } catch (error) {
                    console.error('Error loading questions from JSON:', error);
                }
                return [];
            };

            // Generate explanation for a question
            const generateExplanation = async (question, options, correctAnswer) => {
                try {
                    const prompt = `Explain why the answer "${correctAnswer}" is correct for the following AWS Cloud Practitioner question in 2-3 short sentences:
                    
                    Question: ${question}
                    
                    Options:
                    ${options.map((opt, idx) => `${String.fromCharCode(65 + idx)}. ${opt}`).join('\n')}
                    
                    Provide a clear, concise explanation focusing on AWS concepts. Keep it short and to the point.`;
                    
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyCR5TIp-MG3WmAiHZkCPXrKvHVYAMjcsoU', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [
                                {
                                    parts: [
                                        {
                                            text: prompt
                                        }
                                    ]
                                }
                            ]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to generate explanation');
                    }
                    
                    const data = await response.json();
                    const explanation = data.candidates[0].content.parts[0].text;
                    
                    return explanation;
                } catch (error) {
                    console.error('Error generating explanation:', error);
                    return "Explanation could not be generated at this time. Please try again later.";
                }
            };

            // Show explanation for a question
            const showQuestionExplanation = async (questionIndex) => {
                const question = questions[questionIndex];
                const correctAnswer = answers[questionIndex];
                
                // Check if we already have the explanation
                if (explanations[questionIndex]) {
                    setCurrentExplanation(explanations[questionIndex]);
                    setShowExplanation(true);
                    return;
                }
                
                // Generate explanation
                const explanation = await generateExplanation(
                    question.question, 
                    question.options, 
                    correctAnswer
                );
                
                // Save explanation
                setExplanations({...explanations, [questionIndex]: explanation});
                setCurrentExplanation(explanation);
                setShowExplanation(true);
            };

            const generateSampleQuestions = () => {
                const sampleQuestions = [
                    {
                        question: "What is the main benefit of cloud computing?",
                        options: [
                            "Increased latency",
                            "On-premises dependency",
                            "Pay-as-you-go pricing",
                            "Manual scalability"
                        ]
                    },
                    {
                        question: "Which AWS service provides global infrastructure?",
                        options: [
                            "S3",
                            "EC2",
                            "AWS Regions and Availability Zones",
                            "IAM"
                        ]
                    }
                ];

                const sampleAnswers = ["C", "C"];

                setQuestions(sampleQuestions);
                setAnswers(sampleAnswers);
                setExamTitle('AWS Cloud Practitioner Exam');
                setPracticeMode(true);
                setExamStarted(true);
                setTimeLeft(180); // 3 minutes for sample
                setUserAnswers({});
                setShowResults(false);
                setCurrentQuestion(0);
                setFlaggedQuestions(new Set());
            };

            const handleAnswerSelect = (questionIndex, option) => {
                const correctAnswer = answers[questionIndex] || '';
                const isMultipleChoice = correctAnswer.split(',').filter(a => a.trim()).length > 1;

                if (isMultipleChoice) {
                    const currentAnswers = userAnswers[questionIndex] ? userAnswers[questionIndex].split(',').map(a => a.trim()).filter(a => a) : [];
                    const optionIndex = currentAnswers.indexOf(option);

                    if (optionIndex > -1) {
                        currentAnswers.splice(optionIndex, 1);
                    } else {
                        currentAnswers.push(option);
                    }

                    const sortedAnswers = currentAnswers.sort().join(',');
                    setUserAnswers({ ...userAnswers, [questionIndex]: sortedAnswers });
                } else {
                    setUserAnswers({ ...userAnswers, [questionIndex]: option });
                }
            };

            const toggleFlag = (questionIndex) => {
                const newFlagged = new Set(flaggedQuestions);
                newFlagged.has(questionIndex) ? newFlagged.delete(questionIndex) : newFlagged.add(questionIndex);
                setFlaggedQuestions(newFlagged);
            };

            const startFullPracticeExam = () => {
                // Use all domains for full practice exam
                setSelectedDomains(awsDomains);
                setQuestionCount(60);
                setDifficulty('medium');
                generateQuestionsWithAI(awsDomains, 60, 'medium', 'full');
            };

            const startDomainPractice = () => {
                if (selectedDomains.length === 0) {
                    alert('Please select at least one domain');
                    return;
                }
                
                generateQuestionsWithAI(selectedDomains, questionCount, difficulty, 'domain');
            };

            const handleSubmit = () => {
                let correct = 0;
                questions.forEach((q, idx) => {
                    const userAnswer = (userAnswers[idx] || '').trim();
                    const correctAnswer = (answers[idx] || '').trim();

                    const normalizedUserAnswer = userAnswer.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                    const normalizedCorrectAnswer = correctAnswer.split(',').map(a => a.trim()).filter(a => a).sort().join(',');

                    if (normalizedUserAnswer === normalizedCorrectAnswer) {
                        correct++;
                    }
                });
                setScore(correct);
                setShowResults(true);
                setExamStarted(false);
                setShowConfirmSubmit(false);

                const result = {
                    date: new Date().toLocaleString(),
                    score: correct,
                    total: questions.length,
                    percentage: ((correct / questions.length) * 100).toFixed(1),
                    timeSpent: practiceMode ? (questionCount * 90 - timeLeft) : (9000 - timeLeft),
                    examTitle: examTitle,
                    studentName: userName,
                    questions: questions,
                    answers: answers,
                    userAnswers: userAnswers
                };

                // Save to JSON storage
                saveExamToDatabase(result);
            };

            const resetExam = () => {
                setUserAnswers({});
                setShowResults(false);
                setExamStarted(false);
                setCurrentQuestion(0);
                setTimeLeft(9000);
                setScore(0);
                setFlaggedQuestions(new Set());
                setShowReview(false);
                setExamTitle('AWS Cloud Practitioner Exam');
                setPracticeMode(false);
                setSelectedDomains([]);
                setQuestionCount(10);
                setDifficulty('medium');
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            useEffect(() => {
                if (examStarted && timeLeft > 0 && !showResults) {
                    const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                    return () => clearTimeout(timer);
                } else if (timeLeft === 0 && examStarted) {
                    handleSubmit();
                }
            }, [timeLeft, examStarted, showResults]);

            const percentage = questions.length > 0 ? ((score / questions.length) * 100).toFixed(1) : 0;
            const passed = percentage >= 70;
            const answeredCount = Object.keys(userAnswers).filter(key => userAnswers[key]).length;
            const unansweredCount = questions.length - answeredCount;
            const flaggedCount = flaggedQuestions.size;

            const bgClass = darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50';
            const cardClass = darkMode ? 'bg-gray-800 text-white' : 'bg-white text-gray-900';
            const headerClass = darkMode ? 'bg-gradient-to-r from-gray-700 to-gray-900' : 'bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600';

            // Fixed Answer Review Component
            const AnswerReview = () => {
                const [expandedQuestions, setExpandedQuestions] = useState(new Set());

                const toggleQuestion = (index) => {
                    const newExpanded = new Set(expandedQuestions);
                    if (newExpanded.has(index)) {
                        newExpanded.delete(index);
                    } else {
                        newExpanded.add(index);
                    }
                    setExpandedQuestions(newExpanded);
                };

                return (
                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-2xl font-bold">Detailed Answer Review</h3>
                            <div className="flex items-center space-x-2">
                                <span className={`px-3 py-1 rounded-full text-sm font-bold ${passed ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                    Score: {score}/{questions.length} ({percentage}%)
                                </span>
                            </div>
                        </div>

                        <div className="space-y-4">
                            {questions.map((q, idx) => {
                                const userAns = userAnswers[idx] || 'Not Answered';
                                const correctAns = answers[idx] || '';
                                const userAnswerNorm = userAns.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                                const correctAnswerNorm = correctAns.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                                const isCorrect = userAnswerNorm === correctAnswerNorm;
                                const isExpanded = expandedQuestions.has(idx);

                                return (
                                    <div key={idx} className={`border-2 rounded-lg transition-all duration-300 ${isCorrect
                                        ? 'border-green-500 bg-green-50'
                                        : 'border-red-500 bg-red-50'
                                        }`}>
                                        <div
                                            className="p-4 cursor-pointer hover:bg-opacity-80 transition"
                                            onClick={() => toggleQuestion(idx)}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-3">
                                                    <div className={`w-8 h-8 flex-shrink-0 rounded-full flex items-center justify-center ${isCorrect ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
                                                        }`}>
                                                        {isCorrect ? '✓' : '✗'}
                                                    </div>
                                                    <div>
                                                        <h4 className="font-semibold text-lg">
                                                            Question {idx + 1}
                                                        </h4>
                                                        <p className="text-sm opacity-75">
                                                            {isCorrect ? 'Correct' : 'Incorrect'}
                                                        </p>
                                                    </div>
                                                </div>
                                                <div className={`transform transition-transform ${isExpanded ? 'rotate-180' : ''}`}>
                                                    ▼
                                                </div>
                                            </div>
                                        </div>

                                        {isExpanded && (
                                            <div className="p-4 border-t border-opacity-50 space-y-4">
                                                <div>
                                                    <h5 className="font-bold text-lg mb-2">Question:</h5>
                                                    <p className="text-gray-700 bg-white p-3 rounded border">{q.question}</p>
                                                </div>

                                                <div>
                                                    <h5 className="font-bold text-lg mb-2">Options:</h5>
                                                    <div className="space-y-2">
                                                        {q.options.map((option, optIdx) => {
                                                            const optionLetter = String.fromCharCode(65 + optIdx);
                                                            const isUserAnswer = userAns.includes(optionLetter);
                                                            const isCorrectAnswer = correctAns.includes(optionLetter);

                                                            return (
                                                                <div
                                                                    key={optIdx}
                                                                    className={`p-3 rounded border-2 transition-all ${isUserAnswer && isCorrectAnswer
                                                                        ? 'border-green-500 bg-green-100'
                                                                        : isUserAnswer && !isCorrectAnswer
                                                                            ? 'border-red-500 bg-red-100'
                                                                            : isCorrectAnswer
                                                                                ? 'border-green-500 bg-green-50'
                                                                                : 'border-gray-300 bg-gray-50'
                                                                        }`}
                                                                >
                                                                    <div className="flex items-center space-x-3">
                                                                        <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${isUserAnswer && isCorrectAnswer
                                                                            ? 'border-green-500 bg-green-500 text-white'
                                                                            : isUserAnswer && !isCorrectAnswer
                                                                                ? 'border-red-500 bg-red-500 text-white'
                                                                                : isCorrectAnswer
                                                                                    ? 'border-green-500 text-green-500'
                                                                                    : 'border-gray-400 text-gray-400'
                                                                            }`}>
                                                                            {optionLetter}
                                                                        </div>
                                                                        <span className={isUserAnswer || isCorrectAnswer ? 'font-medium' : ''}>
                                                                            {option}
                                                                        </span>
                                                                        {isUserAnswer && isCorrectAnswer && (
                                                                            <span className="ml-auto text-green-600 font-bold">✓ Your Answer</span>
                                                                        )}
                                                                        {isUserAnswer && !isCorrectAnswer && (
                                                                            <span className="ml-auto text-red-600 font-bold">✗ Your Answer</span>
                                                                        )}
                                                                        {!isUserAnswer && isCorrectAnswer && (
                                                                            <span className="ml-auto text-green-600 font-bold">✓ Correct Answer</span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>

                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div className={`p-3 rounded ${isCorrect ? 'bg-green-100 border border-green-300' : 'bg-red-100 border border-red-300'
                                                        }`}>
                                                        <h6 className="font-semibold mb-1">Your Answer:</h6>
                                                        <p className={isCorrect ? 'text-green-700' : 'text-red-700'}>
                                                            {userAns || 'Not Answered'}
                                                        </p>
                                                    </div>
                                                    <div className="p-3 rounded bg-green-100 border border-green-300">
                                                        <h6 className="font-semibold mb-1">Correct Answer:</h6>
                                                        <p className="text-green-700">{correctAns}</p>
                                                    </div>
                                                </div>
                                                
                                                {!isCorrect && (
                                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                                        <div className="flex items-center justify-between mb-2">
                                                            <h6 className="font-semibold text-blue-800">AI Explanation:</h6>
                                                            <button
                                                                onClick={() => showQuestionExplanation(idx)}
                                                                className="px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm flex items-center space-x-1"
                                                            >
                                                                <Brain />
                                                                <span>Show Explanation</span>
                                                            </button>
                                                        </div>
                                                        {explanations[idx] && (
                                                            <p className="text-blue-700 text-sm">{explanations[idx]}</p>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            // History Exam Review Component
            const HistoryExamReview = ({ exam }) => {
                const [expandedQuestions, setExpandedQuestions] = useState(new Set());

                const toggleQuestion = (index) => {
                    const newExpanded = new Set(expandedQuestions);
                    if (newExpanded.has(index)) {
                        newExpanded.delete(index);
                    } else {
                        newExpanded.add(index);
                    }
                    setExpandedQuestions(newExpanded);
                };

                return (
                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h3 className="text-2xl font-bold">Previous Exam Review</h3>
                                <p className="text-gray-500">Taken on: {exam.date}</p>
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className={`px-3 py-1 rounded-full text-sm font-bold ${exam.percentage >= 70 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                    }`}>
                                    Score: {exam.score}/{exam.total} ({exam.percentage}%)
                                </span>
                                <button
                                    onClick={() => setSelectedHistoryExam(null)}
                                    className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition"
                                >
                                    Back to History
                                </button>
                            </div>
                        </div>

                        <div className="space-y-4">
                            {exam.questions.map((q, idx) => {
                                const userAns = exam.userAnswers[idx] || 'Not Answered';
                                const correctAns = exam.answers[idx] || '';
                                const userAnswerNorm = userAns.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                                const correctAnswerNorm = correctAns.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                                const isCorrect = userAnswerNorm === correctAnswerNorm;
                                const isExpanded = expandedQuestions.has(idx);

                                return (
                                    <div key={idx} className={`border-2 rounded-lg transition-all duration-300 ${isCorrect
                                        ? 'border-green-500 bg-green-50'
                                        : 'border-red-500 bg-red-50'
                                        }`}>
                                        <div
                                            className="p-4 cursor-pointer hover:bg-opacity-80 transition"
                                            onClick={() => toggleQuestion(idx)}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-3">
                                                    <div className={`w-8 h-8 flex-shrink-0 rounded-full flex items-center justify-center ${isCorrect ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
                                                        }`}>
                                                        {isCorrect ? '✓' : '✗'}
                                                    </div>
                                                    <div>
                                                        <h4 className="font-semibold text-lg">
                                                            Question {idx + 1}
                                                        </h4>
                                                        <p className="text-sm opacity-75">
                                                            {isCorrect ? 'Correct' : 'Incorrect'}
                                                        </p>
                                                    </div>
                                                </div>
                                                <div className={`transform transition-transform ${isExpanded ? 'rotate-180' : ''}`}>
                                                    ▼
                                                </div>
                                            </div>
                                        </div>

                                        {isExpanded && (
                                            <div className="p-4 border-t border-opacity-50 space-y-4">
                                                <div>
                                                    <h5 className="font-bold text-lg mb-2">Question:</h5>
                                                    <p className="text-gray-700 bg-white p-3 rounded border">{q.question}</p>
                                                </div>

                                                <div>
                                                    <h5 className="font-bold text-lg mb-2">Options:</h5>
                                                    <div className="space-y-2">
                                                        {q.options.map((option, optIdx) => {
                                                            const optionLetter = String.fromCharCode(65 + optIdx);
                                                            const isUserAnswer = userAns.includes(optionLetter);
                                                            const isCorrectAnswer = correctAns.includes(optionLetter);

                                                            return (
                                                                <div
                                                                    key={optIdx}
                                                                    className={`p-3 rounded border-2 transition-all ${isUserAnswer && isCorrectAnswer
                                                                        ? 'border-green-500 bg-green-100'
                                                                        : isUserAnswer && !isCorrectAnswer
                                                                            ? 'border-red-500 bg-red-100'
                                                                            : isCorrectAnswer
                                                                                ? 'border-green-500 bg-green-50'
                                                                                : 'border-gray-300 bg-gray-50'
                                                                        }`}
                                                                >
                                                                    <div className="flex items-center space-x-3">
                                                                        <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${isUserAnswer && isCorrectAnswer
                                                                            ? 'border-green-500 bg-green-500 text-white'
                                                                            : isUserAnswer && !isCorrectAnswer
                                                                                ? 'border-red-500 bg-red-500 text-white'
                                                                                : isCorrectAnswer
                                                                                    ? 'border-green-500 text-green-500'
                                                                                    : 'border-gray-400 text-gray-400'
                                                                            }`}>
                                                                            {optionLetter}
                                                                        </div>
                                                                        <span className={isUserAnswer || isCorrectAnswer ? 'font-medium' : ''}>
                                                                            {option}
                                                                        </span>
                                                                        {isUserAnswer && isCorrectAnswer && (
                                                                            <span className="ml-auto text-green-600 font-bold">✓ Your Answer</span>
                                                                        )}
                                                                        {isUserAnswer && !isCorrectAnswer && (
                                                                            <span className="ml-auto text-red-600 font-bold">✗ Your Answer</span>
                                                                        )}
                                                                        {!isUserAnswer && isCorrectAnswer && (
                                                                            <span className="ml-auto text-green-600 font-bold">✓ Correct Answer</span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>

                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div className={`p-3 rounded ${isCorrect ? 'bg-green-100 border border-green-300' : 'bg-red-100 border border-red-300'
                                                        }`}>
                                                        <h6 className="font-semibold mb-1">Your Answer:</h6>
                                                        <p className={isCorrect ? 'text-green-700' : 'text-red-700'}>
                                                            {userAns || 'Not Answered'}
                                                        </p>
                                                    </div>
                                                    <div className="p-3 rounded bg-green-100 border border-green-300">
                                                        <h6 className="font-semibold mb-1">Correct Answer:</h6>
                                                        <p className="text-green-700">{correctAns}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            // Teacher Dashboard Components
            const TeacherDashboard = () => {
                const [selectedStudent, setSelectedStudent] = useState(null);
                const [studentExamHistory, setStudentExamHistory] = useState([]);

                const loadStudentDetails = (student) => {
                    setSelectedStudent(student);

                    try {
                        const storedResults = localStorage.getItem('awsExamResults');
                        if (storedResults) {
                            const allResults = JSON.parse(storedResults);
                            const studentResults = allResults.filter(result => result.studentName === student.name);
                            setStudentExamHistory(studentResults);
                        } else {
                            setStudentExamHistory([]);
                        }
                    } catch (error) {
                        console.error('Error loading student details:', error);
                    }
                };

                // Calculate student stats
                const getStudentStats = (studentName) => {
                    try {
                        const storedResults = localStorage.getItem('awsExamResults');
                        if (storedResults) {
                            const allResults = JSON.parse(storedResults);
                            const studentResults = allResults.filter(result => result.studentName === studentName);

                            if (studentResults.length === 0) {
                                return { examCount: 0, avgScore: 0, bestScore: 0 };
                            }

                            const examCount = studentResults.length;
                            const avgScore = studentResults.reduce((sum, result) => sum + parseFloat(result.percentage), 0) / examCount;
                            const bestScore = Math.max(...studentResults.map(result => parseFloat(result.percentage)));

                            return {
                                examCount,
                                avgScore: Math.round(avgScore),
                                bestScore: Math.round(bestScore)
                            };
                        }
                    } catch (error) {
                        console.error('Error calculating student stats:', error);
                    }

                    return { examCount: 0, avgScore: 0, bestScore: 0 };
                };

                return (
                    <div className="space-y-6">
                        {/* Students Overview */}
                        {teacherView === 'dashboard' && (
                            <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                <h3 className="text-2xl font-bold mb-6">Students Overview</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {allStudents.map((student, index) => {
                                        const stats = getStudentStats(student.name);

                                        return (
                                            <div key={index} className="border rounded-lg p-4 hover:shadow-md transition">
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <h4 className="font-bold text-lg">{student.name}</h4>
                                                        <p className="text-sm text-gray-500 capitalize">{student.role}</p>
                                                        <p className="text-xs text-gray-400">
                                                            Joined: {new Date(student.createdAt).toLocaleDateString()}
                                                        </p>
                                                    </div>
                                                    <button
                                                        onClick={() => deleteStudent(student.name)}
                                                        className="text-red-500 hover:text-red-700 p-1"
                                                        title="Delete Student"
                                                    >
                                                        <Trash />
                                                    </button>
                                                </div>
                                                <div className="space-y-2">
                                                    <div className="flex justify-between text-sm">
                                                        <span>Exams Taken:</span>
                                                        <span className="font-bold">{stats.examCount}</span>
                                                    </div>
                                                    <div className="flex justify-between text-sm">
                                                        <span>Average Score:</span>
                                                        <span className={`font-bold ${stats.avgScore >= 70 ? 'text-green-600' : 'text-red-600'
                                                            }`}>
                                                            {stats.avgScore}%
                                                        </span>
                                                    </div>
                                                    <div className="flex justify-between text-sm">
                                                        <span>Best Score:</span>
                                                        <span className={`font-bold ${stats.bestScore >= 70 ? 'text-green-600' : 'text-red-600'
                                                            }`}>
                                                            {stats.bestScore}%
                                                        </span>
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => {
                                                        loadStudentDetails(student);
                                                        setTeacherView('student-details');
                                                    }}
                                                    className="w-full mt-3 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition"
                                                >
                                                    View Details
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* Student Details View */}
                        {teacherView === 'student-details' && selectedStudent && (
                            <div className="space-y-6">
                                <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                    <div className="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 className="text-2xl font-bold">{selectedStudent.name}'s Exam History</h3>
                                            <p className="text-gray-500">Role: {selectedStudent.role}</p>
                                        </div>
                                        <button
                                            onClick={() => setTeacherView('dashboard')}
                                            className="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition"
                                        >
                                            ← Back to Students
                                        </button>
                                    </div>

                                    {studentExamHistory.length > 0 ? (
                                        <div className="space-y-4">
                                            {studentExamHistory.map((exam, index) => (
                                                <div key={index} className="border rounded-lg p-4 hover:shadow-md transition">
                                                    <div className="flex justify-between items-center mb-3">
                                                        <div>
                                                            <h4 className="font-bold text-lg">{exam.examTitle}</h4>
                                                            <p className="text-sm text-gray-500">{new Date(exam.dateCreated).toLocaleString()}</p>
                                                        </div>
                                                        <div className="flex items-center space-x-2">
                                                            <span className={`px-3 py-1 rounded-full text-sm font-bold ${exam.percentage >= 70 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                                }`}>
                                                                {exam.score}/{exam.totalQuestions} ({exam.percentage}%)
                                                            </span>
                                                            <button
                                                                onClick={() => deleteExamResult(exam.id)}
                                                                className="text-red-500 hover:text-red-700 p-1"
                                                                title="Delete Exam Result"
                                                            >
                                                                <Trash />
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center space-x-4 text-sm">
                                                        <span className="flex items-center space-x-1">
                                                            <Clock />
                                                            <span>{formatTime(exam.timeSpent)}</span>
                                                        </span>
                                                        <span className={`px-2 py-1 rounded ${exam.percentage >= 70 ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
                                                            }`}>
                                                            {exam.percentage >= 70 ? 'PASS' : 'FAIL'}
                                                        </span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <p className="text-center text-gray-500 py-8">
                                            No exam history available for {selectedStudent.name}
                                        </p>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Domain Selector Component
            const DomainSelector = () => {
                const toggleDomain = (domain) => {
                    if (selectedDomains.includes(domain)) {
                        setSelectedDomains(selectedDomains.filter(d => d !== domain));
                    } else {
                        setSelectedDomains([...selectedDomains, domain]);
                    }
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                        <div className={`${cardClass} rounded-2xl p-8 max-w-2xl w-full shadow-2xl my-8`}>
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-2xl font-bold">Select Domains for Practice</h3>
                                <button onClick={() => setShowDomainSelector(false)} className="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                            </div>
                            
                            <div className="mb-6">
                                <label className="block text-lg font-semibold mb-3">Number of Questions</label>
                                <select 
                                    value={questionCount} 
                                    onChange={(e) => setQuestionCount(parseInt(e.target.value))}
                                    className={`w-full px-4 py-3 rounded-lg border-2 ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'} focus:border-blue-500 outline-none transition`}
                                >
                                    <option value={10}>10 Questions</option>
                                    <option value={20}>20 Questions</option>
                                    <option value={30}>30 Questions</option>
                                    <option value={40}>40 Questions</option>
                                    <option value={50}>50 Questions</option>
                                </select>
                            </div>
                            
                            <div className="mb-6">
                                <label className="block text-lg font-semibold mb-3">Difficulty Level</label>
                                <select 
                                    value={difficulty} 
                                    onChange={(e) => setDifficulty(e.target.value)}
                                    className={`w-full px-4 py-3 rounded-lg border-2 ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'} focus:border-blue-500 outline-none transition`}
                                >
                                    <option value="easy">Easy</option>
                                    <option value="medium">Medium</option>
                                    <option value="hard">Hard</option>
                                </select>
                            </div>
                            
                            <div className="mb-6">
                                <label className="block text-lg font-semibold mb-3">AWS Domains</label>
                                <div className="space-y-3 max-h-64 overflow-y-auto">
                                    {awsDomains.map((domain, index) => (
                                        <div key={index} className="border rounded-lg overflow-hidden">
                                            <button
                                                onClick={() => toggleDomain(domain)}
                                                className={`w-full p-4 text-left transition ${selectedDomains.includes(domain)
                                                    ? 'bg-blue-500 text-white'
                                                    : darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'
                                                    }`}
                                            >
                                                <div className="flex items-center justify-between">
                                                    <span className="font-semibold">{domain.name}</span>
                                                    {selectedDomains.includes(domain) && (
                                                        <div className="w-6 h-6 bg-white text-blue-500 rounded-full flex items-center justify-center">
                                                            ✓
                                                        </div>
                                                    )}
                                                </div>
                                            </button>
                                            {selectedDomains.includes(domain) && (
                                                <div className="p-3 bg-blue-50 border-t">
                                                    <p className="text-sm text-blue-800 font-medium">Topics included:</p>
                                                    <p className="text-xs text-blue-600">{domain.topics.slice(0, 3).join(', ')}...</p>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="flex justify-end space-x-4">
                                <button
                                    onClick={() => setShowDomainSelector(false)}
                                    className="px-6 py-3 bg-gray-500 text-white rounded-xl font-bold hover:bg-gray-600 transition"
                                >
                                    Cancel
                                </button>
                                <button
                                    onClick={() => {
                                        setShowDomainSelector(false);
                                        startDomainPractice();
                                    }}
                                    disabled={selectedDomains.length === 0 || generatingQuestions}
                                    className="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center space-x-2"
                                >
                                    {generatingQuestions ? (
                                        <>
                                            <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                            <span>Generating...</span>
                                        </>
                                    ) : (
                                        <>
                                            <Zap />
                                            <span>Start Practice</span>
                                        </>
                                    )}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Question Generator Component
            const QuestionGenerator = () => {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                        <div className={`${cardClass} rounded-2xl p-8 max-w-2xl w-full shadow-2xl my-8`}>
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-2xl font-bold">Custom Practice Test</h3>
                                <button onClick={() => setShowQuestionGenerator(false)} className="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                            </div>
                            
                            <div className="mb-6">
                                <p className="mb-4">Generate custom AWS Cloud Practitioner questions using AI. Select domains, difficulty, and number of questions.</p>
                                
                                <div className="mb-6">
                                    <label className="block text-lg font-semibold mb-3">Number of Questions</label>
                                    <select 
                                        value={questionCount} 
                                        onChange={(e) => setQuestionCount(parseInt(e.target.value))}
                                        className={`w-full px-4 py-3 rounded-lg border-2 ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'} focus:border-blue-500 outline-none transition`}
                                    >
                                        <option value={10}>10 Questions</option>
                                        <option value={20}>20 Questions</option>
                                        <option value={30}>30 Questions</option>
                                        <option value={40}>40 Questions</option>
                                        <option value={50}>50 Questions</option>
                                    </select>
                                </div>
                                
                                <div className="mb-6">
                                    <label className="block text-lg font-semibold mb-3">Difficulty Level</label>
                                    <select 
                                        value={difficulty} 
                                        onChange={(e) => setDifficulty(e.target.value)}
                                        className={`w-full px-4 py-3 rounded-lg border-2 ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'} focus:border-blue-500 outline-none transition`}
                                    >
                                        <option value="easy">Easy</option>
                                        <option value="medium">Medium</option>
                                        <option value="hard">Hard</option>
                                    </select>
                                </div>
                                
                                <div className="mb-6">
                                    <label className="block text-lg font-semibold mb-3">AWS Domains</label>
                                    <div className="space-y-3 max-h-64 overflow-y-auto">
                                        {awsDomains.map((domain, index) => (
                                            <div key={index} className="border rounded-lg overflow-hidden">
                                                <button
                                                    onClick={() => {
                                                        if (selectedDomains.includes(domain)) {
                                                            setSelectedDomains(selectedDomains.filter(d => d !== domain));
                                                        } else {
                                                            setSelectedDomains([...selectedDomains, domain]);
                                                        }
                                                    }}
                                                    className={`w-full p-4 text-left transition ${selectedDomains.includes(domain)
                                                        ? 'bg-blue-500 text-white'
                                                        : darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'
                                                        }`}
                                                >
                                                    <div className="flex items-center justify-between">
                                                        <span className="font-semibold">{domain.name}</span>
                                                        {selectedDomains.includes(domain) && (
                                                            <div className="w-6 h-6 bg-white text-blue-500 rounded-full flex items-center justify-center">
                                                                ✓
                                                            </div>
                                                        )}
                                                    </div>
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="flex justify-end space-x-4">
                                <button
                                    onClick={() => setShowQuestionGenerator(false)}
                                    className="px-6 py-3 bg-gray-500 text-white rounded-xl font-bold hover:bg-gray-600 transition"
                                >
                                    Cancel
                                </button>
                                <button
                                    onClick={() => {
                                        setShowQuestionGenerator(false);
                                        generateQuestionsWithAI(selectedDomains, questionCount, difficulty, 'custom');
                                    }}
                                    disabled={selectedDomains.length === 0 || generatingQuestions}
                                    className="px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center space-x-2"
                                >
                                    {generatingQuestions ? (
                                        <>
                                            <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                            <span>Generating...</span>
                                        </>
                                    ) : (
                                        <>
                                            <Brain />
                                            <span>Generate Questions</span>
                                        </>
                                    )}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Explanation Modal
            const ExplanationModal = () => {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div className={`${cardClass} rounded-2xl p-8 max-w-2xl w-full shadow-2xl`}>
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-2xl font-bold">AI Explanation</h3>
                                <button onClick={() => setShowExplanation(false)} className="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                            </div>
                            
                            <div className="mb-6">
                                <p className="text-lg">{currentExplanation}</p>
                            </div>
                            
                            <div className="flex justify-end">
                                <button
                                    onClick={() => setShowExplanation(false)}
                                    className="px-6 py-3 bg-blue-500 text-white rounded-xl font-bold hover:bg-blue-600 transition"
                                >
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Login Handler
            const handleLogin = (role) => {
                if (userName.trim()) {
                    // Save student to JSON storage
                    if (saveStudentToDatabase(userName, role)) {
                        setUserRole(role);
                        if (role === 'student') {
                            loadStudentExamHistory();
                        } else {
                            loadAllStudents();
                        }
                    }
                }
            };

            // Login Screen
            if (!userRole) {
                return (
                    <div className={`min-h-screen ${bgClass} flex items-center justify-center p-4 transition-all duration-500`}>
                        <div className={`${cardClass} rounded-3xl shadow-2xl p-8 max-w-md w-full transform hover:scale-105 transition-all duration-300`}>
                            <div className="text-center mb-8">
                                <div className="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center animate-pulse">
                                    <div className="w-12 h-12 text-white"><BookOpen /></div>
                                </div>
                                <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                                    AWS AI Exam Portal
                                </h1>
                                <p className={darkMode ? 'text-gray-400' : 'text-gray-500'}>AI-Powered AWS Cloud Practitioner Certification Platform</p>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-2">Your Name</label>
                                    <input
                                        type="text"
                                        value={userName}
                                        onChange={(e) => setUserName(e.target.value)}
                                        placeholder="Enter your name"
                                        className={`w-full px-4 py-3 rounded-lg border-2 ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'} focus:border-blue-500 outline-none transition`}
                                    />
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <button
                                        onClick={() => handleLogin('student')}
                                        disabled={!userName.trim()}
                                        className="bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                    >
                                        <div className="flex flex-col items-center space-y-2">
                                            <div className="w-8 h-8"><User /></div>
                                            <span>Student</span>
                                        </div>
                                    </button>
                                    <button
                                        onClick={() => handleLogin('teacher')}
                                        disabled={!userName.trim()}
                                        className="bg-gradient-to-r from-purple-500 to-purple-600 text-white py-4 rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                    >
                                        <div className="flex flex-col items-center space-y-2">
                                            <div className="w-8 h-8"><Users /></div>
                                            <span>Teacher</span>
                                        </div>
                                    </button>
                                </div>
                            </div>

                            <div className="mt-6 text-center">
                                <button onClick={() => setDarkMode(!darkMode)} className={`px-4 py-2 rounded-lg font-medium transition transform hover:scale-105 ${darkMode ? 'bg-yellow-500 text-gray-900' : 'bg-gray-800 text-white'}`}>
                                    {darkMode ? '☀️ Light Mode' : '🌙 Dark Mode'}
                                </button>
                            </div>

                            <div className="mt-4 text-center">
                                <div className="flex items-center justify-center space-x-2 text-green-600">
                                    <Database />
                                    <span className="text-sm">JSON Storage Ready</span>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Teacher Dashboard
            if (userRole === 'teacher') {
                return (
                    <div className={`min-h-screen ${bgClass} transition-colors duration-300`}>
                        <div className={`${headerClass} text-white shadow-lg`}>
                            <div className="max-w-7xl mx-auto px-4 py-4">
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center space-x-4">
                                        <div className="w-10 h-10"><Users /></div>
                                        <div>
                                            <h1 className="text-2xl font-bold">Teacher Dashboard</h1>
                                            <p className="text-sm text-blue-100">Welcome, {userName}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center space-x-4">
                                        <div className="flex items-center space-x-2 text-green-400">
                                            <Database />
                                            <span className="text-sm">{allStudents.length} Students</span>
                                        </div>
                                        <button onClick={() => setDarkMode(!darkMode)} className="px-4 py-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition">
                                            {darkMode ? '☀️' : '🌙'}
                                        </button>
                                        <button onClick={() => setUserRole(null)} className="px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 transition flex items-center space-x-2">
                                            <div className="w-5 h-5"><User /></div>
                                            <span>Logout</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <TeacherDashboard />
                        </div>
                    </div>
                );
            }

            // Student Interface - Show History Exam Review if selected
            if (selectedHistoryExam) {
                return (
                    <div className={`min-h-screen ${bgClass} transition-colors duration-300`}>
                        <div className={`${headerClass} text-white shadow-lg`}>
                            <div className="max-w-7xl mx-auto px-4 py-4">
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center space-x-4">
                                        <div className="w-10 h-10"><History /></div>
                                        <div>
                                            <h1 className="text-2xl font-bold">Exam History Review</h1>
                                            <p className="text-sm text-blue-100">Welcome back, {userName}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center space-x-4">
                                        <button onClick={() => setDarkMode(!darkMode)} className="px-4 py-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition">
                                            {darkMode ? '☀️' : '🌙'}
                                        </button>
                                        <button onClick={() => setSelectedHistoryExam(null)} className="px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 transition flex items-center space-x-2">
                                            <div className="w-5 h-5"><User /></div>
                                            <span>Back to Current</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <HistoryExamReview exam={selectedHistoryExam} />
                        </div>
                    </div>
                );
            }

            // Student Interface - Normal View
            return (
                <div className={`min-h-screen ${bgClass} transition-colors duration-300`}>
                    <div className={`${headerClass} text-white shadow-lg`}>
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center space-x-4">
                                    <div className="w-10 h-10"><BookOpen /></div>
                                    <div>
                                        <h1 className="text-2xl font-bold">{examTitle}</h1>
                                        <p className="text-sm text-blue-100">Welcome, {userName}</p>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-4">
                                    {examStarted && (
                                        <div className={`px-4 py-2 rounded-lg font-bold flex items-center space-x-2 ${timeLeft < 300 ? 'bg-red-500 animate-pulse' : 'bg-white bg-opacity-20'}`}>
                                            <div className="w-5 h-5"><Clock /></div>
                                            <span>{formatTime(timeLeft)}</span>
                                        </div>
                                    )}
                                    <button onClick={() => setShowStats(!showStats)} className="px-4 py-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition flex items-center space-x-2">
                                        <div className="w-5 h-5"><History /></div>
                                        <span>History ({examHistory.length})</span>
                                    </button>
                                    <button onClick={() => setDarkMode(!darkMode)} className="px-4 py-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition">
                                        {darkMode ? '☀️' : '🌙'}
                                    </button>
                                    <button onClick={() => setUserRole(null)} className="px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 transition flex items-center space-x-2">
                                        <div className="w-5 h-5"><User /></div>
                                        <span>Logout</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 py-6">
                        {!examStarted && !showResults ? (
                            <div className="space-y-6">
                                {/* Main Dashboard Card */}
                                <div className={`${cardClass} rounded-3xl shadow-2xl p-8 max-w-4xl mx-auto`}>
                                    <div className="text-center mb-8">
                                        <div className="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                            <div className="w-12 h-12 text-white"><Brain /></div>
                                        </div>
                                        <h2 className="text-3xl font-bold mb-2">AWS Cloud Practitioner AI Learning Platform</h2>
                                        <p className="opacity-75">AI-powered practice tests and explanations to help you pass the AWS exam</p>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className={`p-6 rounded-2xl ${darkMode ? 'bg-gray-700' : 'bg-blue-50'} border-2 border-blue-200`}>
                                            <div className="flex items-center space-x-3 mb-4">
                                                <div className="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                                                    <div className="w-6 h-6 text-white"><Target /></div>
                                                </div>
                                                <h3 className="text-xl font-bold">Domain-Wise Practice</h3>
                                            </div>
                                            <p className="mb-4">Practice specific AWS domains with AI-generated questions tailored to your needs.</p>
                                            <button
                                                onClick={() => setShowDomainSelector(true)}
                                                className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition"
                                            >
                                                Start Domain Practice
                                            </button>
                                        </div>

                                        <div className={`p-6 rounded-2xl ${darkMode ? 'bg-gray-700' : 'bg-purple-50'} border-2 border-purple-200`}>
                                            <div className="flex items-center space-x-3 mb-4">
                                                <div className="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center">
                                                    <div className="w-6 h-6 text-white"><Brain /></div>
                                                </div>
                                                <h3 className="text-xl font-bold">Custom Practice Test</h3>
                                            </div>
                                            <p className="mb-4">Generate custom AWS questions with AI based on your preferred domains and difficulty.</p>
                                            <button
                                                onClick={() => setShowQuestionGenerator(true)}
                                                className="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition"
                                            >
                                                Generate Questions
                                            </button>
                                        </div>

                                        <div className={`p-6 rounded-2xl ${darkMode ? 'bg-gray-700' : 'bg-green-50'} border-2 border-green-200`}>
                                            <div className="flex items-center space-x-3 mb-4">
                                                <div className="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                                                    <div className="w-6 h-6 text-white"><BookOpen /></div>
                                                </div>
                                                <h3 className="text-xl font-bold">Full Practice Exam</h3>
                                            </div>
                                            <p className="mb-4">Take a full-length AWS Cloud Practitioner practice exam with 60 questions and timed conditions.</p>
                                            <button
                                                onClick={startFullPracticeExam}
                                                disabled={generatingQuestions}
                                                className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                            >
                                                {generatingQuestions ? (
                                                    <div className="flex items-center justify-center space-x-2">
                                                        <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                        <span>Generating...</span>
                                                    </div>
                                                ) : (
                                                    "Start Full Exam (60 Questions)"
                                                )}
                                            </button>
                                        </div>

                                        <div className={`p-6 rounded-2xl ${darkMode ? 'bg-gray-700' : 'bg-orange-50'} border-2 border-orange-200`}>
                                            <div className="flex items-center space-x-3 mb-4">
                                                <div className="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center">
                                                    <div className="w-6 h-6 text-white"><Zap /></div>
                                                </div>
                                                <h3 className="text-xl font-bold">Quick Quiz</h3>
                                            </div>
                                            <p className="mb-4">Take a quick 10-question quiz on random AWS domains for daily practice.</p>
                                            <button
                                                onClick={() => {
                                                    const randomDomains = [...awsDomains].sort(() => 0.5 - Math.random()).slice(0, 2);
                                                    setSelectedDomains(randomDomains);
                                                    setQuestionCount(10);
                                                    setDifficulty('medium');
                                                    generateQuestionsWithAI(randomDomains, 10, 'medium', 'quick');
                                                }}
                                                disabled={generatingQuestions}
                                                className="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3 rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                            >
                                                {generatingQuestions ? (
                                                    <div className="flex items-center justify-center space-x-2">
                                                        <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                        <span>Generating...</span>
                                                    </div>
                                                ) : (
                                                    "Start Quick Quiz"
                                                )}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Show recent exam history for quick access */}
                                {examHistory.length > 0 && (
                                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg max-w-4xl mx-auto`}>
                                        <h3 className="text-xl font-bold mb-4 flex items-center space-x-2">
                                            <History />
                                            <span>Recent Exam History</span>
                                        </h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {examHistory.slice(0, 3).map((exam, index) => (
                                                <div key={index} className="border rounded-lg p-4 hover:shadow-md transition cursor-pointer"
                                                    onClick={() => setSelectedHistoryExam(exam)}>
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <h4 className="font-bold">{exam.examTitle}</h4>
                                                            <p className="text-sm text-gray-500">{new Date(exam.dateCreated).toLocaleDateString()}</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className={`text-lg font-bold ${exam.percentage >= 70 ? 'text-green-600' : 'text-red-600'}`}>
                                                                {exam.percentage}%
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div className="flex justify-between text-sm">
                                                        <span>{exam.score}/{exam.totalQuestions}</span>
                                                        <span className="text-blue-600">Click to review</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        ) : showResults ? (
                            <div className="space-y-6">
                                <div className={`${cardClass} rounded-3xl shadow-2xl p-8 text-center`}>
                                    <div className={`w-32 h-32 mx-auto mb-6 rounded-full flex items-center justify-center ${passed ? 'bg-green-100' : 'bg-red-100'}`}>
                                        <div className={`w-20 h-20 ${passed ? 'text-green-600' : 'text-red-600'}`}>
                                            {passed ? <Award /> : <XCircle />}
                                        </div>
                                    </div>
                                    <h2 className="text-4xl font-bold mb-2">{passed ? '🎉 Congratulations!' : '📚 Keep Practicing!'}</h2>
                                    <p className="text-xl mb-6">{passed ? 'You passed the AWS exam!' : 'Focus on weak areas and try again!'}</p>

                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                        <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                            <p className="text-sm opacity-75">Score</p>
                                            <p className="text-2xl font-bold text-blue-600">{score}/{questions.length}</p>
                                        </div>
                                        <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                            <p className="text-sm opacity-75">Percentage</p>
                                            <p className={`text-2xl font-bold ${passed ? 'text-green-600' : 'text-red-600'}`}>{percentage}%</p>
                                        </div>
                                        <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                            <p className="text-sm opacity-75">Time Spent</p>
                                            <p className="text-2xl font-bold text-purple-600">{formatTime(practiceMode ? (questionCount * 90 - timeLeft) : (9000 - timeLeft))}</p>
                                        </div>
                                        <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                            <p className="text-sm opacity-75">Status</p>
                                            <p className={`text-2xl font-bold ${passed ? 'text-green-600' : 'text-red-600'}`}>{passed ? 'PASS' : 'FAIL'}</p>
                                        </div>
                                    </div>

                                    <div className="flex flex-wrap justify-center gap-4">
                                        <button onClick={() => setShowReview(true)} className="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition flex items-center space-x-2">
                                            <div className="w-5 h-5"><Eye /></div>
                                            <span>Review Answers</span>
                                        </button>
                                        <button onClick={resetExam} className="px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition flex items-center space-x-2">
                                            <div className="w-5 h-5"><RotateCcw /></div>
                                            <span>Try Again</span>
                                        </button>
                                    </div>
                                </div>

                                {showReview && <AnswerReview />}
                            </div>
                        ) : (
                            // Exam Interface
                            <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                                <div className="lg:col-span-3 space-y-6">
                                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-xl font-bold">Question {currentQuestion + 1} of {questions.length}</h3>
                                            <button
                                                onClick={() => toggleFlag(currentQuestion)}
                                                className={`p-2 rounded-lg transition ${flaggedQuestions.has(currentQuestion) ? 'bg-yellow-500 text-white' : darkMode ? 'bg-gray-700' : 'bg-gray-200'}`}
                                            >
                                                <div className="w-6 h-6"><Flag /></div>
                                            </button>
                                        </div>

                                        <p className="text-lg mb-6">{questions[currentQuestion].question}</p>

                                        <div className="space-y-3 mb-6">
                                            {questions[currentQuestion].options.map((option, idx) => {
                                                const optionLetter = String.fromCharCode(65 + idx);
                                                const correctAnswer = answers[currentQuestion] || '';
                                                const isMulti = correctAnswer.split(',').filter(a => a.trim()).length > 1;
                                                const userAnswer = userAnswers[currentQuestion] || '';
                                                const isSelected = isMulti
                                                    ? userAnswer.split(',').map(a => a.trim()).includes(optionLetter)
                                                    : userAnswer === optionLetter;

                                                return (
                                                    <button
                                                        key={idx}
                                                        onClick={() => handleAnswerSelect(currentQuestion, optionLetter)}
                                                        className={`w-full p-4 rounded-xl text-left border-2 transition transform hover:scale-105 ${isSelected
                                                            ? 'border-blue-500 bg-blue-50'
                                                            : darkMode ? 'border-gray-600 bg-gray-700 hover:bg-gray-600' : 'border-gray-300 hover:bg-gray-50'
                                                            }`}
                                                    >
                                                        <div className="flex items-center space-x-3">
                                                            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${isSelected ? 'border-blue-500 bg-blue-500' : 'border-gray-400'}`}>
                                                                {isSelected && <span className="text-white text-sm">✓</span>}
                                                            </div>
                                                            <span className="font-semibold">{optionLetter}.</span>
                                                            <span className={isSelected ? 'text-gray-900' : ''}>{option}</span>
                                                        </div>
                                                    </button>
                                                );
                                            })}
                                        </div>

                                        <div className="flex justify-between">
                                            <button
                                                onClick={() => setCurrentQuestion(Math.max(0, currentQuestion - 1))}
                                                disabled={currentQuestion === 0}
                                                className="px-6 py-3 bg-gray-500 text-white rounded-xl font-bold hover:bg-gray-600 transition disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                ← Previous
                                            </button>

                                            {currentQuestion === questions.length - 1 ? (
                                                <button
                                                    onClick={() => setShowConfirmSubmit(true)}
                                                    className="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition"
                                                >
                                                    Submit Exam ✓
                                                </button>
                                            ) : (
                                                <button
                                                    onClick={() => setCurrentQuestion(Math.min(questions.length - 1, currentQuestion + 1))}
                                                    className="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition"
                                                >
                                                    Next →
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                <div className="space-y-6">
                                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                        <h3 className="text-lg font-bold mb-4">Progress</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <div className="flex justify-between text-sm mb-2">
                                                    <span>Answered</span>
                                                    <span className="font-bold text-green-600">{answeredCount}/{questions.length}</span>
                                                </div>
                                                <div className={`h-3 ${darkMode ? 'bg-gray-700' : 'bg-gray-200'} rounded-full overflow-hidden`}>
                                                    <div className="h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-300" style={{ width: `${(answeredCount / questions.length) * 100}%` }} />
                                                </div>
                                            </div>
                                            <div>
                                                <div className="flex justify-between text-sm mb-2">
                                                    <span>Unanswered</span>
                                                    <span className="font-bold text-orange-600">{unansweredCount}</span>
                                                </div>
                                            </div>
                                            <div>
                                                <div className="flex justify-between text-sm mb-2">
                                                    <span>Flagged</span>
                                                    <span className="font-bold text-yellow-600">{flaggedCount}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                        <h3 className="text-lg font-bold mb-4">Question Navigator</h3>
                                        <div className="grid grid-cols-5 gap-2 max-h-96 overflow-y-auto">
                                            {questions.map((_, idx) => {
                                                const isAnswered = userAnswers[idx];
                                                const isFlagged = flaggedQuestions.has(idx);
                                                const isCurrent = idx === currentQuestion;

                                                return (
                                                    <button
                                                        key={idx}
                                                        onClick={() => setCurrentQuestion(idx)}
                                                        className={`aspect-square rounded-lg font-bold text-sm transition transform hover:scale-110 relative ${isCurrent
                                                            ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg'
                                                            : isAnswered
                                                                ? 'bg-green-500 text-white'
                                                                : darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-700'
                                                            }`}
                                                    >
                                                        {idx + 1}
                                                        {isFlagged && (
                                                            <div className="absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center">
                                                                <span className="text-xs">🚩</span>
                                                            </div>
                                                        )}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    <button
                                        onClick={() => setShowConfirmSubmit(true)}
                                        className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg hover:shadow-xl transform hover:scale-105 transition"
                                    >
                                        Submit Exam
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Stats Modal with Full History */}
                    {showStats && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                            <div className={`${cardClass} rounded-2xl p-8 max-w-4xl w-full shadow-2xl my-8`}>
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-2xl font-bold">Your Complete Exam History</h3>
                                    <button onClick={() => setShowStats(false)} className="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                                </div>

                                {examHistory.length > 0 ? (
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                            <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                <p className="text-sm opacity-75">Total Attempts</p>
                                                <p className="text-2xl font-bold text-blue-600">{examHistory.length}</p>
                                            </div>
                                            <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                <p className="text-sm opacity-75">Average Score</p>
                                                <p className="text-2xl font-bold text-green-600">
                                                    {(examHistory.reduce((sum, h) => sum + parseFloat(h.percentage), 0) / examHistory.length).toFixed(1)}%
                                                </p>
                                            </div>
                                            <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                <p className="text-sm opacity-75">Best Score</p>
                                                <p className="text-2xl font-bold text-purple-600">
                                                    {Math.max(...examHistory.map(h => parseFloat(h.percentage)))}%
                                                </p>
                                            </div>
                                        </div>

                                        <div className="space-y-3 max-h-96 overflow-y-auto">
                                            {examHistory.map((exam, idx) => (
                                                <div key={idx} className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} hover:shadow-lg transition cursor-pointer`}
                                                    onClick={() => {
                                                        setSelectedHistoryExam(exam);
                                                        setShowStats(false);
                                                    }}>
                                                    <div className="flex justify-between items-center">
                                                        <div>
                                                            <h4 className="font-bold">{exam.examTitle}</h4>
                                                            <p className="text-sm opacity-75">{new Date(exam.dateCreated).toLocaleString()}</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className={`text-2xl font-bold ${parseFloat(exam.percentage) >= 70 ? 'text-green-600' : 'text-red-600'}`}>
                                                                {exam.percentage}%
                                                            </p>
                                                            <p className="text-sm">{exam.score}/{exam.totalQuestions}</p>
                                                            <p className="text-xs text-blue-600 mt-1">Click to review full exam</p>
                                                        </div>
                                                    </div>
                                                    <div className="mt-2 flex items-center space-x-4 text-sm">
                                                        <span className="flex items-center space-x-1">
                                                            <Clock />
                                                            <span>{formatTime(exam.timeSpent)}</span>
                                                        </span>
                                                        <span className={`px-3 py-1 rounded-full ${parseFloat(exam.percentage) >= 70 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                            {parseFloat(exam.percentage) >= 70 ? 'Pass ✓' : 'Fail ✗'}
                                                        </span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ) : (
                                    <p className="text-center text-gray-500 py-8">No exam history available</p>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Confirm Submit Modal */}
                    {showConfirmSubmit && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className={`${cardClass} rounded-2xl p-8 max-w-md w-full shadow-2xl transform scale-100 animate-pulse`}>
                                <div className="text-center">
                                    <div className="w-16 h-16 mx-auto mb-4 bg-yellow-100 rounded-full flex items-center justify-center">
                                        <div className="w-10 h-10 text-yellow-600"><AlertCircle /></div>
                                    </div>
                                    <h3 className="text-2xl font-bold mb-4">Confirm Submission</h3>
                                    <p className="mb-6">Are you sure you want to submit your AWS exam?</p>
                                    <div className="space-y-2 mb-6 text-left">
                                        <p className="flex justify-between">
                                            <span>Answered:</span>
                                            <span className="font-bold text-green-600">{answeredCount} questions</span>
                                        </p>
                                        <p className="flex justify-between">
                                            <span>Unanswered:</span>
                                            <span className="font-bold text-red-600">{unansweredCount} questions</span>
                                        </p>
                                        <p className="flex justify-between">
                                            <span>Flagged:</span>
                                            <span className="font-bold text-yellow-600">{flaggedCount} questions</span>
                                        </p>
                                    </div>
                                    <div className="flex space-x-4">
                                        <button
                                            onClick={() => setShowConfirmSubmit(false)}
                                            className="flex-1 px-6 py-3 bg-gray-500 text-white rounded-xl font-bold hover:bg-gray-600 transition"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={handleSubmit}
                                            className="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition"
                                        >
                                            Submit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Domain Selector Modal */}
                    {showDomainSelector && <DomainSelector />}

                    {/* Question Generator Modal */}
                    {showQuestionGenerator && <QuestionGenerator />}

                    {/* Explanation Modal */}
                    {showExplanation && <ExplanationModal />}
                </div>
            );
        };

        ReactDOM.render(<ExamSystem />, document.getElementById('root'));
    </script>
</body>

</html>
