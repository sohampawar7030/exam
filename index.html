<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Exam Portal System</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SVG Icons
        const Upload = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></svg>);
        const CheckCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></svg>);
        const XCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><line x1="15" y1="9" x2="9" y2="15" /><line x1="9" y1="9" x2="15" y2="15" /></svg>);
        const RotateCcw = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="1 4 1 10 7 10" /><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" /></svg>);
        const Download = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></svg>);
        const Clock = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></svg>);
        const Award = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7" /><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" /></svg>);
        const BookOpen = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></svg>);
        const Flag = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z" /><line x1="4" y1="22" x2="4" y2="15" /></svg>);
        const BarChart = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10" /><line x1="18" y1="20" x2="18" y2="4" /><line x1="6" y1="20" x2="6" y2="16" /></svg>);
        const Eye = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" /><circle cx="12" cy="12" r="3" /></svg>);
        const AlertCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></svg>);

        const ExamSystem = () => {
            const [questions, setQuestions] = useState([]);
            const [answers, setAnswers] = useState([]);
            const [userAnswers, setUserAnswers] = useState({});
            const [flaggedQuestions, setFlaggedQuestions] = useState(new Set());
            const [showResults, setShowResults] = useState(false);
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [timeLeft, setTimeLeft] = useState(9000);
            const [examStarted, setExamStarted] = useState(false);
            const [score, setScore] = useState(0);
            const [examHistory, setExamHistory] = useState([]);
            const [showStats, setShowStats] = useState(false);
            const [darkMode, setDarkMode] = useState(false);
            const [examTitle, setExamTitle] = useState('AWS Certification Exam');
            const [showReview, setShowReview] = useState(false);
            const [showConfirmSubmit, setShowConfirmSubmit] = useState(false);

            useEffect(() => {
                if (examStarted && timeLeft > 0 && !showResults) {
                    const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                    if (timeLeft === 300) playSound('warning');
                    return () => clearTimeout(timer);
                } else if (timeLeft === 0 && examStarted) {
                    handleSubmit();
                }
            }, [timeLeft, examStarted, showResults]);

            const playSound = (type) => {
                try {
                    const context = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = context.createOscillator();
                    const gainNode = context.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(context.destination);
                    oscillator.frequency.value = type === 'warning' ? 800 : 440;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.3, context.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.5);
                    oscillator.start(context.currentTime);
                    oscillator.stop(context.currentTime + 0.5);
                } catch (e) { }
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                const hours = Math.floor(mins / 60);
                const remainingMins = mins % 60;
                return hours > 0 ? `${hours}:${remainingMins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}` : `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const parseQuestionBank = (text) => {
                const lines = text.split('\n').filter(line => line.trim());
                const parsedQuestions = [];
                let currentQ = null;

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line.match(/^[A-D]\./)) {
                        if (currentQ && currentQ.question) parsedQuestions.push(currentQ);
                        currentQ = { question: line, options: [] };
                    } else if (line.match(/^[A-D]\./) && currentQ) {
                        currentQ.options.push(line.substring(3).trim());
                    }
                }
                if (currentQ && currentQ.question && currentQ.options.length === 4) parsedQuestions.push(currentQ);
                return parsedQuestions;
            };

            const parseAnswerKey = (text) => text.split('\n').filter(line => line.trim()).map(line => line.trim());

            const handleQuestionUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setQuestions(parseQuestionBank(event.target.result));
                        setUserAnswers({});
                        setShowResults(false);
                        setExamStarted(false);
                        setCurrentQuestion(0);
                        setFlaggedQuestions(new Set());
                    };
                    reader.readAsText(file);
                }
            };

            const handleAnswerUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => setAnswers(parseAnswerKey(event.target.result));
                    reader.readAsText(file);
                }
            };

            const handleAnswerSelect = (questionIndex, option) => {
                setUserAnswers({ ...userAnswers, [questionIndex]: option });
            };

            const toggleFlag = (questionIndex) => {
                const newFlagged = new Set(flaggedQuestions);
                newFlagged.has(questionIndex) ? newFlagged.delete(questionIndex) : newFlagged.add(questionIndex);
                setFlaggedQuestions(newFlagged);
            };

            const startExam = () => {
                setExamStarted(true);
                setTimeLeft(9000);
                setUserAnswers({});
                setShowResults(false);
                setCurrentQuestion(0);
                setFlaggedQuestions(new Set());
                playSound('start');
            };

            const handleSubmit = () => {
                let correct = 0;
                questions.forEach((q, idx) => {
                    if (userAnswers[idx] === answers[idx]) correct++;
                });
                setScore(correct);
                setShowResults(true);
                setExamStarted(false);
                setShowConfirmSubmit(false);

                const result = {
                    date: new Date().toLocaleString(),
                    score: correct,
                    total: questions.length,
                    percentage: ((correct / questions.length) * 100).toFixed(1),
                    timeSpent: 9000 - timeLeft
                };
                setExamHistory([result, ...examHistory]);
            };

            const resetExam = () => {
                setUserAnswers({});
                setShowResults(false);
                setExamStarted(false);
                setCurrentQuestion(0);
                setTimeLeft(9000);
                setScore(0);
                setFlaggedQuestions(new Set());
                setShowReview(false);
            };

            const exportResults = () => {
                const results = questions.map((q, idx) => {
                    const userAns = userAnswers[idx] || 'Not Answered';
                    const correctAns = answers[idx];
                    const isCorrect = userAns === correctAns;
                    return `Question ${idx + 1}: ${isCorrect ? 'Correct' : 'Wrong'}\nQuestion: ${q.question}\nYour Answer: ${userAns}\nCorrect Answer: ${correctAns}\n`;
                }).join('\n');

                const blob = new Blob([`${examTitle}\nScore: ${score}/${questions.length} (${percentage}%)\nDate: ${new Date().toLocaleString()}\n\n${results}`], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'exam_results.txt';
                a.click();
            };

            const percentage = questions.length > 0 ? ((score / questions.length) * 100).toFixed(1) : 0;
            const passed = percentage >= 70;
            const answeredCount = Object.keys(userAnswers).length;
            const unansweredCount = questions.length - answeredCount;
            const flaggedCount = flaggedQuestions.size;

            const bgClass = darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50';
            const cardClass = darkMode ? 'bg-gray-800 text-white' : 'bg-white text-gray-900';
            const headerClass = darkMode ? 'bg-gradient-to-r from-gray-700 to-gray-900' : 'bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600';

            return (
                <div className={`min-h-screen ${bgClass} p-4 transition-colors duration-300`}>
                    <div className="max-w-6xl mx-auto">
                        <div className="flex justify-between items-center mb-4">
                            <div className="flex items-center space-x-4">
                                <button onClick={() => setDarkMode(!darkMode)} className={`px-4 py-2 rounded-lg font-medium transition ${darkMode ? 'bg-yellow-500 text-gray-900' : 'bg-gray-800 text-white'}`}>
                                    {darkMode ? '‚òÄÔ∏è Light' : 'üåô Dark'}
                                </button>
                                {examHistory.length > 0 && !examStarted && (
                                    <button onClick={() => setShowStats(!showStats)} className="px-4 py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition flex items-center space-x-2">
                                        <div className="w-5 h-5"><BarChart /></div>
                                        <span>History</span>
                                    </button>
                                )}
                            </div>
                        </div>

                        {showStats && (
                            <div className={`${cardClass} rounded-2xl shadow-2xl p-6 mb-4`}>
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold flex items-center space-x-2">
                                        <div className="w-6 h-6"><BarChart /></div>
                                        <span>Exam History</span>
                                    </h2>
                                    <button onClick={() => setShowStats(false)} className="text-red-500 hover:text-red-700 font-bold text-xl">‚úï</button>
                                </div>
                                <div className="space-y-3">
                                    {examHistory.map((exam, idx) => (
                                        <div key={idx} className={`p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                            <div className="flex justify-between items-center">
                                                <div>
                                                    <p className="font-semibold">{exam.date}</p>
                                                    <p className="text-sm opacity-75">Time: {formatTime(exam.timeSpent)}</p>
                                                </div>
                                                <div className="text-right">
                                                    <p className="text-2xl font-bold">{exam.percentage}%</p>
                                                    <p className="text-sm">{exam.score}/{exam.total}</p>
                                                </div>
                                            </div>
                                            <div className="w-full bg-gray-300 rounded-full h-2 mt-2">
                                                <div className={`h-2 rounded-full ${exam.percentage >= 70 ? 'bg-green-500' : 'bg-red-500'}`} style={{ width: `${exam.percentage}%` }} />
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className={`${cardClass} rounded-2xl shadow-2xl overflow-hidden`}>
                            <div className={`${headerClass} p-6 text-white relative overflow-hidden`}>
                                <div className="absolute inset-0 opacity-10">
                                    <div className="absolute top-0 left-0 w-40 h-40 bg-white rounded-full -translate-x-1/2 -translate-y-1/2"></div>
                                    <div className="absolute bottom-0 right-0 w-60 h-60 bg-white rounded-full translate-x-1/3 translate-y-1/3"></div>
                                </div>
                                <div className="relative">
                                    <h1 className="text-4xl font-bold mb-2 flex items-center space-x-3">
                                        <div className="w-10 h-10"><BookOpen /></div>
                                        <span>{examTitle}</span>
                                    </h1>
                                    <p className="text-blue-100">Professional Certification Exam Portal</p>
                                </div>
                            </div>

                            {!examStarted && !showResults && (
                                <div className="p-6 space-y-6">
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-2">Exam Title</label>
                                        <input type="text" value={examTitle} onChange={(e) => setExamTitle(e.target.value)} className={`w-full px-4 py-2 rounded-lg border-2 ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`} placeholder="Enter exam title" />
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className={`border-2 border-dashed rounded-lg p-6 transition ${darkMode ? 'border-blue-500 hover:border-blue-400' : 'border-blue-300 hover:border-blue-500'}`}>
                                            <label className="cursor-pointer flex flex-col items-center space-y-3">
                                                <div className="w-12 h-12 text-blue-500"><Upload /></div>
                                                <span className="text-sm font-semibold">Upload Question Bank (.txt)</span>
                                                <input type="file" accept=".txt" onChange={handleQuestionUpload} className="hidden" />
                                                {questions.length > 0 && (
                                                    <div className="text-center">
                                                        <span className="text-sm text-green-600 font-bold block">‚úì {questions.length} questions loaded</span>
                                                        <span className="text-xs opacity-75">Ready to start</span>
                                                    </div>
                                                )}
                                            </label>
                                        </div>

                                        <div className={`border-2 border-dashed rounded-lg p-6 transition ${darkMode ? 'border-green-500 hover:border-green-400' : 'border-green-300 hover:border-green-500'}`}>
                                            <label className="cursor-pointer flex flex-col items-center space-y-3">
                                                <div className="w-12 h-12 text-green-500"><Upload /></div>
                                                <span className="text-sm font-semibold">Upload Answer Key (.txt)</span>
                                                <input type="file" accept=".txt" onChange={handleAnswerUpload} className="hidden" />
                                                {answers.length > 0 && (
                                                    <div className="text-center">
                                                        <span className="text-sm text-green-600 font-bold block">‚úì {answers.length} answers loaded</span>
                                                        <span className="text-xs opacity-75">Ready to grade</span>
                                                    </div>
                                                )}
                                            </label>
                                        </div>
                                    </div>

                                    {questions.length > 0 && answers.length > 0 && (
                                        <div className="space-y-4">
                                            <div className={`p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-blue-50'}`}>
                                                <h3 className="font-semibold mb-2 flex items-center space-x-2">
                                                    <div className="w-5 h-5 text-blue-600"><AlertCircle /></div>
                                                    <span>Exam Information</span>
                                                </h3>
                                                <ul className="text-sm space-y-1 ml-7">
                                                    <li>‚Ä¢ Total Questions: {questions.length}</li>
                                                    <li>‚Ä¢ Time Limit: {formatTime(9000)}</li>
                                                    <li>‚Ä¢ Passing Score: 70%</li>
                                                    <li>‚Ä¢ You can flag questions for review</li>
                                                    <li>‚Ä¢ Navigate freely between questions</li>
                                                </ul>
                                            </div>
                                            <button onClick={startExam} className="w-full bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white py-5 rounded-xl font-bold text-xl hover:shadow-2xl transform hover:scale-105 transition duration-300 flex items-center justify-center space-x-3">
                                                <div className="w-6 h-6"><BookOpen /></div>
                                                <span>Start Exam ({questions.length} Questions)</span>
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}

                            {examStarted && !showResults && questions.length > 0 && (
                                <div className="p-6">
                                    <div className={`grid grid-cols-4 gap-3 mb-6 p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gradient-to-r from-blue-50 to-indigo-50'}`}>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-blue-600">{answeredCount}</div>
                                            <div className="text-xs opacity-75">Answered</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-red-600">{unansweredCount}</div>
                                            <div className="text-xs opacity-75">Remaining</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-yellow-600">{flaggedCount}</div>
                                            <div className="text-xs opacity-75">Flagged</div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${timeLeft < 300 ? 'text-red-600 animate-pulse' : 'text-green-600'}`}>{formatTime(timeLeft)}</div>
                                            <div className="text-xs opacity-75">Time Left</div>
                                        </div>
                                    </div>

                                    <div className="mb-6">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm font-medium">Question {currentQuestion + 1} of {questions.length}</span>
                                            <button onClick={() => toggleFlag(currentQuestion)} className={`p-2 rounded-lg transition ${flaggedQuestions.has(currentQuestion) ? 'bg-yellow-500 text-white' : darkMode ? 'bg-gray-700' : 'bg-gray-200'}`}>
                                                <div className="w-5 h-5"><Flag /></div>
                                            </button>
                                        </div>
                                        <div className={`w-full ${darkMode ? 'bg-gray-700' : 'bg-gray-200'} rounded-full h-3`}>
                                            <div className="bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full transition-all duration-300" style={{ width: `${((currentQuestion + 1) / questions.length) * 100}%` }} />
                                        </div>
                                    </div>

                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gradient-to-br from-blue-50 to-indigo-50'} p-6 rounded-xl mb-6 shadow-lg`}>
                                        <h3 className="text-lg font-semibold mb-4">{questions[currentQuestion].question}</h3>
                                        <div className="space-y-3">
                                            {questions[currentQuestion].options.map((option, idx) => {
                                                const optionLetter = String.fromCharCode(65 + idx);
                                                const isSelected = userAnswers[currentQuestion] === optionLetter;
                                                return (
                                                    <button key={idx} onClick={() => handleAnswerSelect(currentQuestion, optionLetter)} className={`w-full text-left p-4 rounded-lg border-2 transition-all duration-200 transform hover:scale-102 ${isSelected ? 'border-blue-600 bg-blue-100 shadow-lg scale-102' : darkMode ? 'border-gray-600 bg-gray-800 hover:border-blue-400' : 'border-gray-300 bg-white hover:border-blue-400 hover:shadow-md'}`}>
                                                        <span className="font-bold text-blue-600 text-lg">{optionLetter}.</span> {option}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    <div className="flex justify-between items-center">
                                        <button onClick={() => setCurrentQuestion(Math.max(0, currentQuestion - 1))} disabled={currentQuestion === 0} className="px-6 py-3 bg-gray-600 text-white rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition">‚Üê Previous</button>
                                        <button onClick={() => setShowReview(true)} className="px-6 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition flex items-center space-x-2">
                                            <div className="w-5 h-5"><Eye /></div>
                                            <span>Review All</span>
                                        </button>
                                        {currentQuestion === questions.length - 1 ? (
                                            <button onClick={() => setShowConfirmSubmit(true)} className="px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition">Submit Exam ‚Üí</button>
                                        ) : (
                                            <button onClick={() => setCurrentQuestion(Math.min(questions.length - 1, currentQuestion + 1))} className="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition">Next ‚Üí</button>
                                        )}
                                    </div>

                                    <div className={`mt-6 pt-6 border-t ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
                                        <h4 className="text-sm font-medium mb-3">Quick Navigation</h4>
                                        <div className="grid grid-cols-10 gap-2">
                                            {questions.map((_, idx) => {
                                                const isFlagged = flaggedQuestions.has(idx);
                                                const isAnswered = userAnswers[idx];
                                                return (
                                                    <button key={idx} onClick={() => setCurrentQuestion(idx)} className={`relative w-10 h-10 rounded-lg font-medium text-sm transition ${idx === currentQuestion ? 'bg-blue-600 text-white ring-2 ring-blue-400' : isAnswered ? 'bg-green-500 text-white' : darkMode ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' : 'bg-gray-200 text-gray-600 hover:bg-gray-300'}`}>
                                                        {idx + 1}
                                                        {isFlagged && <div className="absolute -top-1 -right-1 w-3 h-3 bg-yellow-500 rounded-full"></div>}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {showReview && examStarted && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                    <div className={`${cardClass} rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6`}>
                                        <div className="flex justify-between items-center mb-6">
                                            <h2 className="text-2xl font-bold">Review Your Answers</h2>
                                            <button onClick={() => setShowReview(false)} className="text-red-500 hover:text-red-700 font-bold text-2xl">‚úï</button>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4 mb-6">
                                            <div className={`p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-green-50'}`}>
                                                <div className="text-3xl font-bold text-green-600">{answeredCount}</div>
                                                <div className="text-sm">Answered</div>
                                            </div>
                                            <div className={`p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-red-50'}`}>
                                                <div className="text-3xl font-bold text-red-600">{unansweredCount}</div>
                                                <div className="text-sm">Unanswered</div>
                                            </div>
                                        </div>

                                        <div className="space-y-3">
                                            {questions.map((q, idx) => {
                                                const isAnswered = userAnswers[idx];
                                                const isFlagged = flaggedQuestions.has(idx);
                                                return (
                                                    <div key={idx} className={`p-4 rounded-lg border-2 cursor-pointer transition ${isAnswered ? darkMode ? 'border-green-600 bg-gray-700' : 'border-green-300 bg-green-50' : darkMode ? 'border-red-600 bg-gray-700' : 'border-red-300 bg-red-50'}`} onClick={() => { setCurrentQuestion(idx); setShowReview(false); }}>
                                                        <div className="flex justify-between items-start">
                                                            <div className="flex-1">
                                                                <span className="font-semibold">Q{idx + 1}: </span>
                                                                <span className="text-sm">{q.question.substring(0, 80)}...</span>
                                                            </div>
                                                            <div className="flex items-center space-x-2">
                                                                {isFlagged && <div className="w-5 h-5 text-yellow-500"><Flag /></div>}
                                                                <span className={`text-sm font-bold ${isAnswered ? 'text-green-600' : 'text-red-600'}`}>
                                                                    {isAnswered ? `‚úì ${userAnswers[idx]}` : '‚úó Unanswered'}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>

                                        <div className="flex space-x-4 mt-6">
                                            <button onClick={() => setShowReview(false)} className="flex-1 px-6 py-3 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700 transition">Continue Exam</button>
                                            <button onClick={() => { setShowReview(false); setShowConfirmSubmit(true); }} className="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition">Submit Now</button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {showConfirmSubmit && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                    <div className={`${cardClass} rounded-2xl max-w-md w-full p-6`}>
                                        <div className="text-center">
                                            <div className="w-16 h-16 mx-auto mb-4 text-yellow-500"><AlertCircle /></div>
                                            <h2 className="text-2xl font-bold mb-4">Submit Exam?</h2>
                                            <p className="mb-2">You have answered <strong>{answeredCount}</strong> out of <strong>{questions.length}</strong> questions.</p>
                                            {unansweredCount > 0 && (
                                                <p className="text-red-600 font-semibold mb-4">Warning: {unansweredCount} question(s) remain unanswered!</p>
                                            )}
                                            <p className="text-sm opacity-75 mb-6">You cannot change your answers after submission.</p>
                                            <div className="flex space-x-4">
                                                <button onClick={() => setShowConfirmSubmit(false)} className="flex-1 px-6 py-3 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700 transition">Cancel</button>
                                                <button onClick={handleSubmit} className="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition">Submit</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {showResults && (
                                <div className="p-6">
                                    <div className={`text-center mb-8 p-8 rounded-2xl ${passed ? darkMode ? 'bg-green-900' : 'bg-green-50' : darkMode ? 'bg-red-900' : 'bg-red-50'}`}>
                                        <div className={`w-24 h-24 mx-auto mb-4 ${passed ? 'text-green-600' : 'text-red-600'}`}>
                                            <Award />
                                        </div>
                                        <h2 className="text-4xl font-bold mb-3">{passed ? 'üéâ Congratulations!' : 'üìö Keep Practicing!'}</h2>
                                        <div className="relative inline-block mb-4">
                                            <p className="text-7xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">{percentage}%</p>
                                        </div>
                                        <p className="text-2xl mb-2">{score} out of {questions.length} correct</p>
                                        <p className={`mt-4 text-xl font-semibold ${passed ? 'text-green-600' : 'text-red-600'}`}>
                                            {passed ? '‚úì You Passed!' : '‚úó Minimum 70% required to pass'}
                                        </p>
                                        <div className="mt-6 grid grid-cols-3 gap-4">
                                            <div>
                                                <div className="text-3xl font-bold text-green-600">{score}</div>
                                                <div className="text-sm opacity-75">Correct</div>
                                            </div>
                                            <div>
                                                <div className="text-3xl font-bold text-red-600">{questions.length - score}</div>
                                                <div className="text-sm opacity-75">Wrong</div>
                                            </div>
                                            <div>
                                                <div className="text-3xl font-bold text-blue-600">{formatTime(9000 - timeLeft)}</div>
                                                <div className="text-sm opacity-75">Time Used</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-lg mb-6`}>
                                        <h3 className="font-semibold mb-2">Performance Breakdown</h3>
                                        <div className="space-y-2">
                                            <div className="flex justify-between">
                                                <span>Accuracy Rate:</span>
                                                <span className="font-bold">{percentage}%</span>
                                            </div>
                                            <div className="w-full bg-gray-300 rounded-full h-3">
                                                <div className={`h-3 rounded-full ${passed ? 'bg-green-500' : 'bg-red-500'}`} style={{ width: `${percentage}%` }} />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="space-y-4 max-h-96 overflow-y-auto mb-6">
                                        {questions.map((q, idx) => {
                                            const userAns = userAnswers[idx] || 'Not Answered';
                                            const correctAns = answers[idx];
                                            const isCorrect = userAns === correctAns;
                                            return (
                                                <div key={idx} className={`p-4 rounded-lg border-2 ${isCorrect ? darkMode ? 'border-green-600 bg-gray-700' : 'border-green-300 bg-green-50' : darkMode ? 'border-red-600 bg-gray-700' : 'border-red-300 bg-red-50'}`}>
                                                    <div className="flex items-start space-x-3">
                                                        <div className={`w-6 h-6 flex-shrink-0 mt-1 ${isCorrect ? 'text-green-600' : 'text-red-600'}`}>
                                                            {isCorrect ? <CheckCircle /> : <XCircle />}
                                                        </div>
                                                        <div className="flex-1">
                                                            <p className="font-medium mb-2">
                                                                <span className="text-blue-600">Q{idx + 1}:</span> {q.question}
                                                            </p>
                                                            <div className="text-sm space-y-1">
                                                                <p>
                                                                    <span className="font-semibold">Your Answer:</span>{' '}
                                                                    <span className={userAns === 'Not Answered' ? 'text-gray-500' : isCorrect ? 'text-green-700 font-bold' : 'text-red-700 font-bold'}>
                                                                        {userAns}
                                                                    </span>
                                                                </p>
                                                                {!isCorrect && (
                                                                    <p>
                                                                        <span className="font-semibold">Correct Answer:</span>{' '}
                                                                        <span className="text-green-700 font-bold">{correctAns}</span>
                                                                    </p>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>

                                    <div className="grid md:grid-cols-3 gap-4">
                                        <button onClick={resetExam} className="flex items-center justify-center space-x-2 bg-blue-600 text-white py-4 rounded-lg font-medium hover:bg-blue-700 transition shadow-lg">
                                            <div className="w-5 h-5"><RotateCcw /></div>
                                            <span>Retake Exam</span>
                                        </button>
                                        <button onClick={exportResults} className="flex items-center justify-center space-x-2 bg-green-600 text-white py-4 rounded-lg font-medium hover:bg-green-700 transition shadow-lg">
                                            <div className="w-5 h-5"><Download /></div>
                                            <span>Export Results</span>
                                        </button>
                                        <button onClick={() => setShowStats(true)} className="flex items-center justify-center space-x-2 bg-purple-600 text-white py-4 rounded-lg font-medium hover:bg-purple-700 transition shadow-lg">
                                            <div className="w-5 h-5"><BarChart /></div>
                                            <span>View History</span>
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="text-center mt-6 text-sm opacity-75">
                            <p>Professional Exam Management System | Developed with ‚ù§Ô∏è</p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ExamSystem />, document.getElementById('root'));
    </script>
</body>

</html>