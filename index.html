<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Cloud Practitioner Exam Portal</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SVG Icons
        const Upload = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2 2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></svg>);
        const CheckCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></svg>);
        const XCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><line x1="15" y1="9" x2="9" y2="15" /><line x1="9" y1="9" x2="15" y2="15" /></svg>);
        const RotateCcw = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="1 4 1 10 7 10" /><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" /></svg>);
        const Download = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2 2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></svg>);
        const Clock = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></svg>);
        const Award = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7" /><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" /></svg>);
        const BookOpen = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></svg>);
        const Flag = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z" /><line x1="4" y1="22" x2="4" y2="15" /></svg>);
        const BarChart = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10" /><line x1="18" y1="20" x2="18" y2="4" /><line x1="6" y1="20" x2="6" y2="16" /></svg>);
        const Eye = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" /><circle cx="12" cy="12" r="3" /></svg>);
        const AlertCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></svg>);
        const User = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>);
        const Users = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M23 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></svg>);
        const FileText = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" /></svg>);
        const Database = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" /><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" /></svg>);
        const Trash = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /></svg>);
        const History = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v5h5" /><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8" /><path d="M12 7v5l4 2" /></svg>);

        const ExamSystem = () => {
            const [userRole, setUserRole] = useState(null);
            const [userName, setUserName] = useState('');
            const [questions, setQuestions] = useState([]);
            const [answers, setAnswers] = useState([]);
            const [userAnswers, setUserAnswers] = useState({});
            const [flaggedQuestions, setFlaggedQuestions] = useState(new Set());
            const [showResults, setShowResults] = useState(false);
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [timeLeft, setTimeLeft] = useState(9000);
            const [examStarted, setExamStarted] = useState(false);
            const [score, setScore] = useState(0);
            const [examHistory, setExamHistory] = useState([]);
            const [showStats, setShowStats] = useState(false);
            const [darkMode, setDarkMode] = useState(false);
            const [examTitle, setExamTitle] = useState('AWS Cloud Practitioner Exam');
            const [showReview, setShowReview] = useState(false);
            const [showConfirmSubmit, setShowConfirmSubmit] = useState(false);
            const [allStudents, setAllStudents] = useState([]);
            const [teacherView, setTeacherView] = useState('dashboard');
            const [selectedHistoryExam, setSelectedHistoryExam] = useState(null);

            // Initialize JSON Storage
            useEffect(() => {
                loadAllStudents();
                if (userRole === 'student') {
                    loadStudentExamHistory();
                }
            }, [userRole]);

            // Load all students for teacher view
            const loadAllStudents = () => {
                try {
                    const storedData = localStorage.getItem('awsExamStudents');
                    if (storedData) {
                        const studentsData = JSON.parse(storedData);
                        setAllStudents(studentsData);
                    }
                } catch (error) {
                    console.error('Error loading students:', error);
                }
            };

            // Load student's exam history
            const loadStudentExamHistory = () => {
                if (!userName) return;

                try {
                    const storedData = localStorage.getItem('awsExamResults');
                    if (storedData) {
                        const allResults = JSON.parse(storedData);
                        const studentResults = allResults.filter(result => result.studentName === userName);
                        setExamHistory(studentResults);
                    }
                } catch (error) {
                    console.error('Error loading exam history:', error);
                }
            };

            // Save student to JSON storage
            const saveStudentToDatabase = (name, role) => {
                try {
                    const storedData = localStorage.getItem('awsExamStudents');
                    let students = storedData ? JSON.parse(storedData) : [];

                    // Check if student already exists
                    const existingStudentIndex = students.findIndex(s => s.name === name);

                    if (existingStudentIndex >= 0) {
                        // Update existing student
                        students[existingStudentIndex].role = role;
                        students[existingStudentIndex].updatedAt = new Date().toISOString();
                    } else {
                        // Add new student
                        students.push({
                            id: Date.now().toString(),
                            name: name,
                            role: role,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        });
                    }

                    localStorage.setItem('awsExamStudents', JSON.stringify(students));
                    setAllStudents(students);
                    return true;
                } catch (error) {
                    console.error('Error saving student:', error);
                    return false;
                }
            };

            // Save exam results to JSON storage
            const saveExamToDatabase = (examData) => {
                try {
                    const storedData = localStorage.getItem('awsExamResults');
                    let examResults = storedData ? JSON.parse(storedData) : [];

                    examResults.push({
                        id: Date.now().toString(),
                        studentName: examData.studentName,
                        examTitle: examData.examTitle,
                        score: examData.score,
                        totalQuestions: examData.total,
                        percentage: examData.percentage,
                        timeSpent: examData.timeSpent,
                        dateCreated: new Date().toISOString(),
                        questions: examData.questions,
                        answers: examData.answers,
                        userAnswers: examData.userAnswers
                    });

                    localStorage.setItem('awsExamResults', JSON.stringify(examResults));
                    console.log('Exam results saved to JSON storage');
                    loadStudentExamHistory();
                    loadAllStudents();
                } catch (error) {
                    console.error('Error saving exam results:', error);
                }
            };

            // Delete student and their data
            const deleteStudent = (studentName) => {
                try {
                    // Delete student from students list
                    const storedStudents = localStorage.getItem('awsExamStudents');
                    if (storedStudents) {
                        let students = JSON.parse(storedStudents);
                        students = students.filter(s => s.name !== studentName);
                        localStorage.setItem('awsExamStudents', JSON.stringify(students));
                        setAllStudents(students);
                    }

                    // Delete student's exam results
                    const storedResults = localStorage.getItem('awsExamResults');
                    if (storedResults) {
                        let examResults = JSON.parse(storedResults);
                        examResults = examResults.filter(result => result.studentName !== studentName);
                        localStorage.setItem('awsExamResults', JSON.stringify(examResults));
                    }

                    console.log(`Student ${studentName} deleted successfully`);
                } catch (error) {
                    console.error('Error deleting student:', error);
                }
            };

            // Delete specific exam result
            const deleteExamResult = (examId) => {
                try {
                    const storedResults = localStorage.getItem('awsExamResults');
                    if (storedResults) {
                        let examResults = JSON.parse(storedResults);
                        examResults = examResults.filter(result => result.id !== examId);
                        localStorage.setItem('awsExamResults', JSON.stringify(examResults));
                        loadStudentExamHistory();
                        loadAllStudents();
                        console.log('Exam result deleted successfully');
                    }
                } catch (error) {
                    console.error('Error deleting exam result:', error);
                }
            };

            // Load a previous exam attempt for review
            const loadPreviousExam = (examData) => {
                setQuestions(examData.questions);
                setAnswers(examData.answers);
                setUserAnswers(examData.userAnswers);
                setScore(examData.score);
                setExamTitle(`${examData.examTitle} (Previous Attempt)`);
                setShowResults(true);
                setShowStats(false);
                setSelectedHistoryExam(null);
            };

            // Enhanced question parser
            const parseQuestionBank = (text) => {
                const lines = text.split('\n').filter(line => line.trim());
                const parsedQuestions = [];
                let currentQ = null;

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    const isNewQuestion =
                        /^\d+[\.\)]/.test(line) ||
                        (line.length > 30 && /[?]/.test(line) && !/^[A-Z][\.\)]/.test(line)) ||
                        (!currentQ && line.length > 10);

                    if (isNewQuestion && currentQ && currentQ.options.length > 0) {
                        parsedQuestions.push(currentQ);
                        currentQ = null;
                    }

                    if (isNewQuestion || !currentQ) {
                        let questionText = line.replace(/^\d+[\.\)]\s*/, '').trim();

                        if (questionText.length > 150) {
                            const sentences = questionText.split(/[.!?]+/);
                            if (sentences.length > 1) {
                                questionText = sentences[0] + (questionText.match(/[.!?]/) ? questionText.match(/[.!?]/)[0] : '');
                            }
                        }

                        currentQ = { question: questionText, options: [] };
                    } else if (currentQ && /^[A-Z][\.\)]\s/.test(line)) {
                        const optionText = line.replace(/^[A-Z][\.\)]\s*/, '').trim();
                        if (optionText) {
                            currentQ.options.push(optionText);
                        }
                    } else if (currentQ && currentQ.options.length === 0 && line.length > 0) {
                        currentQ.options.push(line);
                    }
                }

                if (currentQ && currentQ.options.length > 0) {
                    parsedQuestions.push(currentQ);
                }

                return parsedQuestions;
            };

            const parseAnswerKey = (text) => {
                const lines = text.split('\n').filter(line => line.trim());
                const answers = [];

                for (let line of lines) {
                    const cleanLine = line.trim();
                    const answerMatch = cleanLine.match(/^(\d+[\.\)]\s*)?([A-Z,]+)/);
                    if (answerMatch) {
                        answers.push(answerMatch[2]);
                    } else if (cleanLine.length === 1 && /[A-Z]/.test(cleanLine)) {
                        answers.push(cleanLine);
                    }
                }

                return answers;
            };

            const handleQuestionUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const parsedQuestions = parseQuestionBank(event.target.result);
                        setQuestions(parsedQuestions);
                        setUserAnswers({});
                        setShowResults(false);
                        setExamStarted(false);
                        setCurrentQuestion(0);
                        setFlaggedQuestions(new Set());
                        setExamTitle('AWS Cloud Practitioner Exam');
                    };
                    reader.readAsText(file);
                }
            };

            const handleAnswerUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const parsedAnswers = parseAnswerKey(event.target.result);
                        setAnswers(parsedAnswers);
                    };
                    reader.readAsText(file);
                }
            };

            const generateSampleQuestions = () => {
                const sampleQuestions = [
                    {
                        question: "What is the main benefit of cloud computing?",
                        options: [
                            "Increased latency",
                            "On-premises dependency",
                            "Pay-as-you-go pricing",
                            "Manual scalability"
                        ]
                    },
                    {
                        question: "Which AWS service provides global infrastructure?",
                        options: [
                            "S3",
                            "EC2",
                            "AWS Regions and Availability Zones",
                            "IAM"
                        ]
                    }
                ];

                const sampleAnswers = ["C", "C"];

                setQuestions(sampleQuestions);
                setAnswers(sampleAnswers);
                setExamTitle('AWS Cloud Practitioner Exam');
            };

            const handleAnswerSelect = (questionIndex, option) => {
                const correctAnswer = answers[questionIndex] || '';
                const isMultipleChoice = correctAnswer.split(',').filter(a => a.trim()).length > 1;

                if (isMultipleChoice) {
                    const currentAnswers = userAnswers[questionIndex] ? userAnswers[questionIndex].split(',').map(a => a.trim()).filter(a => a) : [];
                    const optionIndex = currentAnswers.indexOf(option);

                    if (optionIndex > -1) {
                        currentAnswers.splice(optionIndex, 1);
                    } else {
                        currentAnswers.push(option);
                    }

                    const sortedAnswers = currentAnswers.sort().join(',');
                    setUserAnswers({ ...userAnswers, [questionIndex]: sortedAnswers });
                } else {
                    setUserAnswers({ ...userAnswers, [questionIndex]: option });
                }
            };

            const toggleFlag = (questionIndex) => {
                const newFlagged = new Set(flaggedQuestions);
                newFlagged.has(questionIndex) ? newFlagged.delete(questionIndex) : newFlagged.add(questionIndex);
                setFlaggedQuestions(newFlagged);
            };

            const startExam = () => {
                setExamStarted(true);
                setTimeLeft(9000);
                setUserAnswers({});
                setShowResults(false);
                setCurrentQuestion(0);
                setFlaggedQuestions(new Set());
                setExamTitle('AWS Cloud Practitioner Exam');
            };

            const handleSubmit = () => {
                let correct = 0;
                questions.forEach((q, idx) => {
                    const userAnswer = (userAnswers[idx] || '').trim();
                    const correctAnswer = (answers[idx] || '').trim();

                    const normalizedUserAnswer = userAnswer.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                    const normalizedCorrectAnswer = correctAnswer.split(',').map(a => a.trim()).filter(a => a).sort().join(',');

                    if (normalizedUserAnswer === normalizedCorrectAnswer) {
                        correct++;
                    }
                });
                setScore(correct);
                setShowResults(true);
                setExamStarted(false);
                setShowConfirmSubmit(false);

                const result = {
                    date: new Date().toLocaleString(),
                    score: correct,
                    total: questions.length,
                    percentage: ((correct / questions.length) * 100).toFixed(1),
                    timeSpent: 9000 - timeLeft,
                    examTitle: examTitle,
                    studentName: userName,
                    questions: questions,
                    answers: answers,
                    userAnswers: userAnswers
                };

                // Save to JSON storage
                saveExamToDatabase(result);
            };

            const resetExam = () => {
                setUserAnswers({});
                setShowResults(false);
                setExamStarted(false);
                setCurrentQuestion(0);
                setTimeLeft(9000);
                setScore(0);
                setFlaggedQuestions(new Set());
                setShowReview(false);
                setExamTitle('AWS Cloud Practitioner Exam');
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            useEffect(() => {
                if (examStarted && timeLeft > 0 && !showResults) {
                    const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                    return () => clearTimeout(timer);
                } else if (timeLeft === 0 && examStarted) {
                    handleSubmit();
                }
            }, [timeLeft, examStarted, showResults]);

            const percentage = questions.length > 0 ? ((score / questions.length) * 100).toFixed(1) : 0;
            const passed = percentage >= 70;
            const answeredCount = Object.keys(userAnswers).filter(key => userAnswers[key]).length;
            const unansweredCount = questions.length - answeredCount;
            const flaggedCount = flaggedQuestions.size;

            const bgClass = darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50';
            const cardClass = darkMode ? 'bg-gray-800 text-white' : 'bg-white text-gray-900';
            const headerClass = darkMode ? 'bg-gradient-to-r from-gray-700 to-gray-900' : 'bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600';

            // Fixed Answer Review Component
            const AnswerReview = () => {
                const [expandedQuestions, setExpandedQuestions] = useState(new Set());

                const toggleQuestion = (index) => {
                    const newExpanded = new Set(expandedQuestions);
                    if (newExpanded.has(index)) {
                        newExpanded.delete(index);
                    } else {
                        newExpanded.add(index);
                    }
                    setExpandedQuestions(newExpanded);
                };

                return (
                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-2xl font-bold">Detailed Answer Review</h3>
                            <div className="flex items-center space-x-2">
                                <span className={`px-3 py-1 rounded-full text-sm font-bold ${passed ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                    Score: {score}/{questions.length} ({percentage}%)
                                </span>
                            </div>
                        </div>

                        <div className="space-y-4">
                            {questions.map((q, idx) => {
                                const userAns = userAnswers[idx] || 'Not Answered';
                                const correctAns = answers[idx] || '';
                                const userAnswerNorm = userAns.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                                const correctAnswerNorm = correctAns.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                                const isCorrect = userAnswerNorm === correctAnswerNorm;
                                const isExpanded = expandedQuestions.has(idx);

                                return (
                                    <div key={idx} className={`border-2 rounded-lg transition-all duration-300 ${isCorrect
                                        ? 'border-green-500 bg-green-50'
                                        : 'border-red-500 bg-red-50'
                                        }`}>
                                        <div
                                            className="p-4 cursor-pointer hover:bg-opacity-80 transition"
                                            onClick={() => toggleQuestion(idx)}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-3">
                                                    <div className={`w-8 h-8 flex-shrink-0 rounded-full flex items-center justify-center ${isCorrect ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
                                                        }`}>
                                                        {isCorrect ? '✓' : '✗'}
                                                    </div>
                                                    <div>
                                                        <h4 className="font-semibold text-lg">
                                                            Question {idx + 1}
                                                        </h4>
                                                        <p className="text-sm opacity-75">
                                                            {isCorrect ? 'Correct' : 'Incorrect'}
                                                        </p>
                                                    </div>
                                                </div>
                                                <div className={`transform transition-transform ${isExpanded ? 'rotate-180' : ''}`}>
                                                    ▼
                                                </div>
                                            </div>
                                        </div>

                                        {isExpanded && (
                                            <div className="p-4 border-t border-opacity-50 space-y-4">
                                                <div>
                                                    <h5 className="font-bold text-lg mb-2">Question:</h5>
                                                    <p className="text-gray-700 bg-white p-3 rounded border">{q.question}</p>
                                                </div>

                                                <div>
                                                    <h5 className="font-bold text-lg mb-2">Options:</h5>
                                                    <div className="space-y-2">
                                                        {q.options.map((option, optIdx) => {
                                                            const optionLetter = String.fromCharCode(65 + optIdx);
                                                            const isUserAnswer = userAns.includes(optionLetter);
                                                            const isCorrectAnswer = correctAns.includes(optionLetter);

                                                            return (
                                                                <div
                                                                    key={optIdx}
                                                                    className={`p-3 rounded border-2 transition-all ${isUserAnswer && isCorrectAnswer
                                                                        ? 'border-green-500 bg-green-100'
                                                                        : isUserAnswer && !isCorrectAnswer
                                                                            ? 'border-red-500 bg-red-100'
                                                                            : isCorrectAnswer
                                                                                ? 'border-green-500 bg-green-50'
                                                                                : 'border-gray-300 bg-gray-50'
                                                                        }`}
                                                                >
                                                                    <div className="flex items-center space-x-3">
                                                                        <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${isUserAnswer && isCorrectAnswer
                                                                            ? 'border-green-500 bg-green-500 text-white'
                                                                            : isUserAnswer && !isCorrectAnswer
                                                                                ? 'border-red-500 bg-red-500 text-white'
                                                                                : isCorrectAnswer
                                                                                    ? 'border-green-500 text-green-500'
                                                                                    : 'border-gray-400 text-gray-400'
                                                                            }`}>
                                                                            {optionLetter}
                                                                        </div>
                                                                        <span className={isUserAnswer || isCorrectAnswer ? 'font-medium' : ''}>
                                                                            {option}
                                                                        </span>
                                                                        {isUserAnswer && isCorrectAnswer && (
                                                                            <span className="ml-auto text-green-600 font-bold">✓ Your Answer</span>
                                                                        )}
                                                                        {isUserAnswer && !isCorrectAnswer && (
                                                                            <span className="ml-auto text-red-600 font-bold">✗ Your Answer</span>
                                                                        )}
                                                                        {!isUserAnswer && isCorrectAnswer && (
                                                                            <span className="ml-auto text-green-600 font-bold">✓ Correct Answer</span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>

                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div className={`p-3 rounded ${isCorrect ? 'bg-green-100 border border-green-300' : 'bg-red-100 border border-red-300'
                                                        }`}>
                                                        <h6 className="font-semibold mb-1">Your Answer:</h6>
                                                        <p className={isCorrect ? 'text-green-700' : 'text-red-700'}>
                                                            {userAns || 'Not Answered'}
                                                        </p>
                                                    </div>
                                                    <div className="p-3 rounded bg-green-100 border border-green-300">
                                                        <h6 className="font-semibold mb-1">Correct Answer:</h6>
                                                        <p className="text-green-700">{correctAns}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            // History Exam Review Component
            const HistoryExamReview = ({ exam }) => {
                const [expandedQuestions, setExpandedQuestions] = useState(new Set());

                const toggleQuestion = (index) => {
                    const newExpanded = new Set(expandedQuestions);
                    if (newExpanded.has(index)) {
                        newExpanded.delete(index);
                    } else {
                        newExpanded.add(index);
                    }
                    setExpandedQuestions(newExpanded);
                };

                return (
                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h3 className="text-2xl font-bold">Previous Exam Review</h3>
                                <p className="text-gray-500">Taken on: {exam.date}</p>
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className={`px-3 py-1 rounded-full text-sm font-bold ${exam.percentage >= 70 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                    }`}>
                                    Score: {exam.score}/{exam.total} ({exam.percentage}%)
                                </span>
                                <button
                                    onClick={() => setSelectedHistoryExam(null)}
                                    className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition"
                                >
                                    Back to History
                                </button>
                            </div>
                        </div>

                        <div className="space-y-4">
                            {exam.questions.map((q, idx) => {
                                const userAns = exam.userAnswers[idx] || 'Not Answered';
                                const correctAns = exam.answers[idx] || '';
                                const userAnswerNorm = userAns.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                                const correctAnswerNorm = correctAns.split(',').map(a => a.trim()).filter(a => a).sort().join(',');
                                const isCorrect = userAnswerNorm === correctAnswerNorm;
                                const isExpanded = expandedQuestions.has(idx);

                                return (
                                    <div key={idx} className={`border-2 rounded-lg transition-all duration-300 ${isCorrect
                                        ? 'border-green-500 bg-green-50'
                                        : 'border-red-500 bg-red-50'
                                        }`}>
                                        <div
                                            className="p-4 cursor-pointer hover:bg-opacity-80 transition"
                                            onClick={() => toggleQuestion(idx)}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-3">
                                                    <div className={`w-8 h-8 flex-shrink-0 rounded-full flex items-center justify-center ${isCorrect ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
                                                        }`}>
                                                        {isCorrect ? '✓' : '✗'}
                                                    </div>
                                                    <div>
                                                        <h4 className="font-semibold text-lg">
                                                            Question {idx + 1}
                                                        </h4>
                                                        <p className="text-sm opacity-75">
                                                            {isCorrect ? 'Correct' : 'Incorrect'}
                                                        </p>
                                                    </div>
                                                </div>
                                                <div className={`transform transition-transform ${isExpanded ? 'rotate-180' : ''}`}>
                                                    ▼
                                                </div>
                                            </div>
                                        </div>

                                        {isExpanded && (
                                            <div className="p-4 border-t border-opacity-50 space-y-4">
                                                <div>
                                                    <h5 className="font-bold text-lg mb-2">Question:</h5>
                                                    <p className="text-gray-700 bg-white p-3 rounded border">{q.question}</p>
                                                </div>

                                                <div>
                                                    <h5 className="font-bold text-lg mb-2">Options:</h5>
                                                    <div className="space-y-2">
                                                        {q.options.map((option, optIdx) => {
                                                            const optionLetter = String.fromCharCode(65 + optIdx);
                                                            const isUserAnswer = userAns.includes(optionLetter);
                                                            const isCorrectAnswer = correctAns.includes(optionLetter);

                                                            return (
                                                                <div
                                                                    key={optIdx}
                                                                    className={`p-3 rounded border-2 transition-all ${isUserAnswer && isCorrectAnswer
                                                                        ? 'border-green-500 bg-green-100'
                                                                        : isUserAnswer && !isCorrectAnswer
                                                                            ? 'border-red-500 bg-red-100'
                                                                            : isCorrectAnswer
                                                                                ? 'border-green-500 bg-green-50'
                                                                                : 'border-gray-300 bg-gray-50'
                                                                        }`}
                                                                >
                                                                    <div className="flex items-center space-x-3">
                                                                        <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${isUserAnswer && isCorrectAnswer
                                                                            ? 'border-green-500 bg-green-500 text-white'
                                                                            : isUserAnswer && !isCorrectAnswer
                                                                                ? 'border-red-500 bg-red-500 text-white'
                                                                                : isCorrectAnswer
                                                                                    ? 'border-green-500 text-green-500'
                                                                                    : 'border-gray-400 text-gray-400'
                                                                            }`}>
                                                                            {optionLetter}
                                                                        </div>
                                                                        <span className={isUserAnswer || isCorrectAnswer ? 'font-medium' : ''}>
                                                                            {option}
                                                                        </span>
                                                                        {isUserAnswer && isCorrectAnswer && (
                                                                            <span className="ml-auto text-green-600 font-bold">✓ Your Answer</span>
                                                                        )}
                                                                        {isUserAnswer && !isCorrectAnswer && (
                                                                            <span className="ml-auto text-red-600 font-bold">✗ Your Answer</span>
                                                                        )}
                                                                        {!isUserAnswer && isCorrectAnswer && (
                                                                            <span className="ml-auto text-green-600 font-bold">✓ Correct Answer</span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>

                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div className={`p-3 rounded ${isCorrect ? 'bg-green-100 border border-green-300' : 'bg-red-100 border border-red-300'
                                                        }`}>
                                                        <h6 className="font-semibold mb-1">Your Answer:</h6>
                                                        <p className={isCorrect ? 'text-green-700' : 'text-red-700'}>
                                                            {userAns || 'Not Answered'}
                                                        </p>
                                                    </div>
                                                    <div className="p-3 rounded bg-green-100 border border-green-300">
                                                        <h6 className="font-semibold mb-1">Correct Answer:</h6>
                                                        <p className="text-green-700">{correctAns}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            // Teacher Dashboard Components
            const TeacherDashboard = () => {
                const [selectedStudent, setSelectedStudent] = useState(null);
                const [studentExamHistory, setStudentExamHistory] = useState([]);

                const loadStudentDetails = (student) => {
                    setSelectedStudent(student);

                    try {
                        const storedResults = localStorage.getItem('awsExamResults');
                        if (storedResults) {
                            const allResults = JSON.parse(storedResults);
                            const studentResults = allResults.filter(result => result.studentName === student.name);
                            setStudentExamHistory(studentResults);
                        } else {
                            setStudentExamHistory([]);
                        }
                    } catch (error) {
                        console.error('Error loading student details:', error);
                    }
                };

                // Calculate student stats
                const getStudentStats = (studentName) => {
                    try {
                        const storedResults = localStorage.getItem('awsExamResults');
                        if (storedResults) {
                            const allResults = JSON.parse(storedResults);
                            const studentResults = allResults.filter(result => result.studentName === studentName);

                            if (studentResults.length === 0) {
                                return { examCount: 0, avgScore: 0, bestScore: 0 };
                            }

                            const examCount = studentResults.length;
                            const avgScore = studentResults.reduce((sum, result) => sum + parseFloat(result.percentage), 0) / examCount;
                            const bestScore = Math.max(...studentResults.map(result => parseFloat(result.percentage)));

                            return {
                                examCount,
                                avgScore: Math.round(avgScore),
                                bestScore: Math.round(bestScore)
                            };
                        }
                    } catch (error) {
                        console.error('Error calculating student stats:', error);
                    }

                    return { examCount: 0, avgScore: 0, bestScore: 0 };
                };

                return (
                    <div className="space-y-6">
                        {/* Students Overview */}
                        {teacherView === 'dashboard' && (
                            <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                <h3 className="text-2xl font-bold mb-6">Students Overview</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {allStudents.map((student, index) => {
                                        const stats = getStudentStats(student.name);

                                        return (
                                            <div key={index} className="border rounded-lg p-4 hover:shadow-md transition">
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <h4 className="font-bold text-lg">{student.name}</h4>
                                                        <p className="text-sm text-gray-500 capitalize">{student.role}</p>
                                                        <p className="text-xs text-gray-400">
                                                            Joined: {new Date(student.createdAt).toLocaleDateString()}
                                                        </p>
                                                    </div>
                                                    <button
                                                        onClick={() => deleteStudent(student.name)}
                                                        className="text-red-500 hover:text-red-700 p-1"
                                                        title="Delete Student"
                                                    >
                                                        <Trash />
                                                    </button>
                                                </div>
                                                <div className="space-y-2">
                                                    <div className="flex justify-between text-sm">
                                                        <span>Exams Taken:</span>
                                                        <span className="font-bold">{stats.examCount}</span>
                                                    </div>
                                                    <div className="flex justify-between text-sm">
                                                        <span>Average Score:</span>
                                                        <span className={`font-bold ${stats.avgScore >= 70 ? 'text-green-600' : 'text-red-600'
                                                            }`}>
                                                            {stats.avgScore}%
                                                        </span>
                                                    </div>
                                                    <div className="flex justify-between text-sm">
                                                        <span>Best Score:</span>
                                                        <span className={`font-bold ${stats.bestScore >= 70 ? 'text-green-600' : 'text-red-600'
                                                            }`}>
                                                            {stats.bestScore}%
                                                        </span>
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => {
                                                        loadStudentDetails(student);
                                                        setTeacherView('student-details');
                                                    }}
                                                    className="w-full mt-3 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition"
                                                >
                                                    View Details
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* Student Details View */}
                        {teacherView === 'student-details' && selectedStudent && (
                            <div className="space-y-6">
                                <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                    <div className="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 className="text-2xl font-bold">{selectedStudent.name}'s Exam History</h3>
                                            <p className="text-gray-500">Role: {selectedStudent.role}</p>
                                        </div>
                                        <button
                                            onClick={() => setTeacherView('dashboard')}
                                            className="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition"
                                        >
                                            ← Back to Students
                                        </button>
                                    </div>

                                    {studentExamHistory.length > 0 ? (
                                        <div className="space-y-4">
                                            {studentExamHistory.map((exam, index) => (
                                                <div key={index} className="border rounded-lg p-4 hover:shadow-md transition">
                                                    <div className="flex justify-between items-center mb-3">
                                                        <div>
                                                            <h4 className="font-bold text-lg">{exam.examTitle}</h4>
                                                            <p className="text-sm text-gray-500">{new Date(exam.dateCreated).toLocaleString()}</p>
                                                        </div>
                                                        <div className="flex items-center space-x-2">
                                                            <span className={`px-3 py-1 rounded-full text-sm font-bold ${exam.percentage >= 70 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                                }`}>
                                                                {exam.score}/{exam.totalQuestions} ({exam.percentage}%)
                                                            </span>
                                                            <button
                                                                onClick={() => deleteExamResult(exam.id)}
                                                                className="text-red-500 hover:text-red-700 p-1"
                                                                title="Delete Exam Result"
                                                            >
                                                                <Trash />
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center space-x-4 text-sm">
                                                        <span className="flex items-center space-x-1">
                                                            <Clock />
                                                            <span>{formatTime(exam.timeSpent)}</span>
                                                        </span>
                                                        <span className={`px-2 py-1 rounded ${exam.percentage >= 70 ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
                                                            }`}>
                                                            {exam.percentage >= 70 ? 'PASS' : 'FAIL'}
                                                        </span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <p className="text-center text-gray-500 py-8">
                                            No exam history available for {selectedStudent.name}
                                        </p>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Login Handler
            const handleLogin = (role) => {
                if (userName.trim()) {
                    // Save student to JSON storage
                    if (saveStudentToDatabase(userName, role)) {
                        setUserRole(role);
                        if (role === 'student') {
                            loadStudentExamHistory();
                        } else {
                            loadAllStudents();
                        }
                    }
                }
            };

            // Login Screen
            if (!userRole) {
                return (
                    <div className={`min-h-screen ${bgClass} flex items-center justify-center p-4 transition-all duration-500`}>
                        <div className={`${cardClass} rounded-3xl shadow-2xl p-8 max-w-md w-full transform hover:scale-105 transition-all duration-300`}>
                            <div className="text-center mb-8">
                                <div className="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center animate-pulse">
                                    <div className="w-12 h-12 text-white"><BookOpen /></div>
                                </div>
                                <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                                    AWS Exam Portal
                                </h1>
                                <p className={darkMode ? 'text-gray-400' : 'text-gray-500'}>AWS Cloud Practitioner Certification Platform</p>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-2">Your Name</label>
                                    <input
                                        type="text"
                                        value={userName}
                                        onChange={(e) => setUserName(e.target.value)}
                                        placeholder="Enter your name"
                                        className={`w-full px-4 py-3 rounded-lg border-2 ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'} focus:border-blue-500 outline-none transition`}
                                    />
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <button
                                        onClick={() => handleLogin('student')}
                                        disabled={!userName.trim()}
                                        className="bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                    >
                                        <div className="flex flex-col items-center space-y-2">
                                            <div className="w-8 h-8"><User /></div>
                                            <span>Student</span>
                                        </div>
                                    </button>
                                    <button
                                        onClick={() => handleLogin('teacher')}
                                        disabled={!userName.trim()}
                                        className="bg-gradient-to-r from-purple-500 to-purple-600 text-white py-4 rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                    >
                                        <div className="flex flex-col items-center space-y-2">
                                            <div className="w-8 h-8"><Users /></div>
                                            <span>Teacher</span>
                                        </div>
                                    </button>
                                </div>
                            </div>

                            <div className="mt-6 text-center">
                                <button onClick={() => setDarkMode(!darkMode)} className={`px-4 py-2 rounded-lg font-medium transition transform hover:scale-105 ${darkMode ? 'bg-yellow-500 text-gray-900' : 'bg-gray-800 text-white'}`}>
                                    {darkMode ? '☀️ Light Mode' : '🌙 Dark Mode'}
                                </button>
                            </div>

                            <div className="mt-4 text-center">
                                <div className="flex items-center justify-center space-x-2 text-green-600">
                                    <Database />
                                    <span className="text-sm">JSON Storage Ready</span>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Teacher Dashboard
            if (userRole === 'teacher') {
                return (
                    <div className={`min-h-screen ${bgClass} transition-colors duration-300`}>
                        <div className={`${headerClass} text-white shadow-lg`}>
                            <div className="max-w-7xl mx-auto px-4 py-4">
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center space-x-4">
                                        <div className="w-10 h-10"><Users /></div>
                                        <div>
                                            <h1 className="text-2xl font-bold">Teacher Dashboard</h1>
                                            <p className="text-sm text-blue-100">Welcome, {userName}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center space-x-4">
                                        <div className="flex items-center space-x-2 text-green-400">
                                            <Database />
                                            <span className="text-sm">{allStudents.length} Students</span>
                                        </div>
                                        <button onClick={() => setDarkMode(!darkMode)} className="px-4 py-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition">
                                            {darkMode ? '☀️' : '🌙'}
                                        </button>
                                        <button onClick={() => setUserRole(null)} className="px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 transition flex items-center space-x-2">
                                            <div className="w-5 h-5"><User /></div>
                                            <span>Logout</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <TeacherDashboard />
                        </div>
                    </div>
                );
            }

            // Student Interface - Show History Exam Review if selected
            if (selectedHistoryExam) {
                return (
                    <div className={`min-h-screen ${bgClass} transition-colors duration-300`}>
                        <div className={`${headerClass} text-white shadow-lg`}>
                            <div className="max-w-7xl mx-auto px-4 py-4">
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center space-x-4">
                                        <div className="w-10 h-10"><History /></div>
                                        <div>
                                            <h1 className="text-2xl font-bold">Exam History Review</h1>
                                            <p className="text-sm text-blue-100">Welcome back, {userName}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center space-x-4">
                                        <button onClick={() => setDarkMode(!darkMode)} className="px-4 py-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition">
                                            {darkMode ? '☀️' : '🌙'}
                                        </button>
                                        <button onClick={() => setSelectedHistoryExam(null)} className="px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 transition flex items-center space-x-2">
                                            <div className="w-5 h-5"><User /></div>
                                            <span>Back to Current</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <HistoryExamReview exam={selectedHistoryExam} />
                        </div>
                    </div>
                );
            }

            // Student Interface - Normal View
            return (
                <div className={`min-h-screen ${bgClass} transition-colors duration-300`}>
                    <div className={`${headerClass} text-white shadow-lg`}>
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center space-x-4">
                                    <div className="w-10 h-10"><BookOpen /></div>
                                    <div>
                                        <h1 className="text-2xl font-bold">{examTitle}</h1>
                                        <p className="text-sm text-blue-100">Welcome, {userName}</p>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-4">
                                    {examStarted && (
                                        <div className={`px-4 py-2 rounded-lg font-bold flex items-center space-x-2 ${timeLeft < 300 ? 'bg-red-500 animate-pulse' : 'bg-white bg-opacity-20'}`}>
                                            <div className="w-5 h-5"><Clock /></div>
                                            <span>{formatTime(timeLeft)}</span>
                                        </div>
                                    )}
                                    <button onClick={() => setShowStats(!showStats)} className="px-4 py-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition flex items-center space-x-2">
                                        <div className="w-5 h-5"><History /></div>
                                        <span>History ({examHistory.length})</span>
                                    </button>
                                    <button onClick={() => setDarkMode(!darkMode)} className="px-4 py-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition">
                                        {darkMode ? '☀️' : '🌙'}
                                    </button>
                                    <button onClick={() => setUserRole(null)} className="px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 transition flex items-center space-x-2">
                                        <div className="w-5 h-5"><User /></div>
                                        <span>Logout</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 py-6">
                        {!examStarted && !showResults ? (
                            <div className="space-y-6">
                                {/* Main Upload Card */}
                                <div className={`${cardClass} rounded-3xl shadow-2xl p-8 max-w-2xl mx-auto`}>
                                    <div className="text-center mb-8">
                                        <div className="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                            <div className="w-12 h-12 text-white"><Upload /></div>
                                        </div>
                                        <h2 className="text-3xl font-bold mb-2">AWS Cloud Practitioner Exam</h2>
                                        <p className="opacity-75">Upload question bank and answer key to start your practice</p>
                                    </div>

                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-lg font-semibold mb-3">Question Bank</label>
                                            <label className={`block w-full px-6 py-8 border-2 border-dashed rounded-2xl cursor-pointer transition transform hover:scale-105 ${questions.length > 0
                                                ? 'border-green-500 bg-green-50'
                                                : darkMode ? 'border-gray-600 bg-gray-700 hover:bg-gray-600' : 'border-gray-300 hover:bg-gray-50'
                                                }`}>
                                                <input type="file" accept=".txt" onChange={handleQuestionUpload} className="hidden" />
                                                <div className="text-center">
                                                    <div className={`w-12 h-12 mx-auto mb-3 ${questions.length > 0 ? 'text-green-500' : 'text-gray-400'}`}>
                                                        {questions.length > 0 ? <CheckCircle /> : <Upload />}
                                                    </div>
                                                    <p className="font-medium">{questions.length > 0 ? `${questions.length} Questions Loaded` : 'Click to upload questions'}</p>
                                                </div>
                                            </label>
                                        </div>

                                        <div>
                                            <label className="block text-lg font-semibold mb-3">Answer Key</label>
                                            <label className={`block w-full px-6 py-8 border-2 border-dashed rounded-2xl cursor-pointer transition transform hover:scale-105 ${answers.length > 0
                                                ? 'border-green-500 bg-green-50'
                                                : darkMode ? 'border-gray-600 bg-gray-700 hover:bg-gray-600' : 'border-gray-300 hover:bg-gray-50'
                                                }`}>
                                                <input type="file" accept=".txt" onChange={handleAnswerUpload} className="hidden" />
                                                <div className="text-center">
                                                    <div className={`w-12 h-12 mx-auto mb-3 ${answers.length > 0 ? 'text-green-500' : 'text-gray-400'}`}>
                                                        {answers.length > 0 ? <CheckCircle /> : <Upload />}
                                                    </div>
                                                    <p className="font-medium">{answers.length > 0 ? `${answers.length} Answers Loaded` : 'Click to upload answers'}</p>
                                                </div>
                                            </label>
                                        </div>

                                        <button
                                            onClick={generateSampleQuestions}
                                            className="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3 rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition"
                                        >
                                            🚀 Load Sample Questions
                                        </button>

                                        <button
                                            onClick={startExam}
                                            disabled={questions.length === 0 || answers.length === 0}
                                            className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg hover:shadow-xl transform hover:scale-105 transition disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                        >
                                            🚀 Start AWS Practice Exam
                                        </button>
                                    </div>
                                </div>

                                {/* Show recent exam history for quick access */}
                                {examHistory.length > 0 && (
                                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg max-w-2xl mx-auto`}>
                                        <h3 className="text-xl font-bold mb-4 flex items-center space-x-2">
                                            <History />
                                            <span>Recent Exam History</span>
                                        </h3>
                                        <div className="space-y-3">
                                            {examHistory.slice(0, 3).map((exam, index) => (
                                                <div key={index} className="border rounded-lg p-4 hover:shadow-md transition cursor-pointer"
                                                    onClick={() => setSelectedHistoryExam(exam)}>
                                                    <div className="flex justify-between items-center">
                                                        <div>
                                                            <h4 className="font-bold">{exam.examTitle}</h4>
                                                            <p className="text-sm text-gray-500">{new Date(exam.dateCreated).toLocaleString()}</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className={`text-lg font-bold ${exam.percentage >= 70 ? 'text-green-600' : 'text-red-600'}`}>
                                                                {exam.score}/{exam.totalQuestions} ({exam.percentage}%)
                                                            </p>
                                                            <p className="text-sm">Click to review</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        ) : showResults ? (
                            <div className="space-y-6">
                                <div className={`${cardClass} rounded-3xl shadow-2xl p-8 text-center`}>
                                    <div className={`w-32 h-32 mx-auto mb-6 rounded-full flex items-center justify-center ${passed ? 'bg-green-100' : 'bg-red-100'}`}>
                                        <div className={`w-20 h-20 ${passed ? 'text-green-600' : 'text-red-600'}`}>
                                            {passed ? <Award /> : <XCircle />}
                                        </div>
                                    </div>
                                    <h2 className="text-4xl font-bold mb-2">{passed ? '🎉 Congratulations!' : '📚 Keep Practicing!'}</h2>
                                    <p className="text-xl mb-6">{passed ? 'You passed the AWS exam!' : 'Focus on weak areas and try again!'}</p>

                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                        <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                            <p className="text-sm opacity-75">Score</p>
                                            <p className="text-2xl font-bold text-blue-600">{score}/{questions.length}</p>
                                        </div>
                                        <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                            <p className="text-sm opacity-75">Percentage</p>
                                            <p className={`text-2xl font-bold ${passed ? 'text-green-600' : 'text-red-600'}`}>{percentage}%</p>
                                        </div>
                                        <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                            <p className="text-sm opacity-75">Time Spent</p>
                                            <p className="text-2xl font-bold text-purple-600">{formatTime(9000 - timeLeft)}</p>
                                        </div>
                                        <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                            <p className="text-sm opacity-75">Status</p>
                                            <p className={`text-2xl font-bold ${passed ? 'text-green-600' : 'text-red-600'}`}>{passed ? 'PASS' : 'FAIL'}</p>
                                        </div>
                                    </div>

                                    <div className="flex flex-wrap justify-center gap-4">
                                        <button onClick={() => setShowReview(true)} className="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition flex items-center space-x-2">
                                            <div className="w-5 h-5"><Eye /></div>
                                            <span>Review Answers</span>
                                        </button>
                                        <button onClick={resetExam} className="px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition flex items-center space-x-2">
                                            <div className="w-5 h-5"><RotateCcw /></div>
                                            <span>Try Again</span>
                                        </button>
                                    </div>
                                </div>

                                {showReview && <AnswerReview />}
                            </div>
                        ) : (
                            // Exam Interface
                            <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                                <div className="lg:col-span-3 space-y-6">
                                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-xl font-bold">Question {currentQuestion + 1} of {questions.length}</h3>
                                            <button
                                                onClick={() => toggleFlag(currentQuestion)}
                                                className={`p-2 rounded-lg transition ${flaggedQuestions.has(currentQuestion) ? 'bg-yellow-500 text-white' : darkMode ? 'bg-gray-700' : 'bg-gray-200'}`}
                                            >
                                                <div className="w-6 h-6"><Flag /></div>
                                            </button>
                                        </div>

                                        <p className="text-lg mb-6">{questions[currentQuestion].question}</p>

                                        <div className="space-y-3 mb-6">
                                            {questions[currentQuestion].options.map((option, idx) => {
                                                const optionLetter = String.fromCharCode(65 + idx);
                                                const correctAnswer = answers[currentQuestion] || '';
                                                const isMulti = correctAnswer.split(',').filter(a => a.trim()).length > 1;
                                                const userAnswer = userAnswers[currentQuestion] || '';
                                                const isSelected = isMulti
                                                    ? userAnswer.split(',').map(a => a.trim()).includes(optionLetter)
                                                    : userAnswer === optionLetter;

                                                return (
                                                    <button
                                                        key={idx}
                                                        onClick={() => handleAnswerSelect(currentQuestion, optionLetter)}
                                                        className={`w-full p-4 rounded-xl text-left border-2 transition transform hover:scale-105 ${isSelected
                                                            ? 'border-blue-500 bg-blue-50'
                                                            : darkMode ? 'border-gray-600 bg-gray-700 hover:bg-gray-600' : 'border-gray-300 hover:bg-gray-50'
                                                            }`}
                                                    >
                                                        <div className="flex items-center space-x-3">
                                                            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${isSelected ? 'border-blue-500 bg-blue-500' : 'border-gray-400'}`}>
                                                                {isSelected && <span className="text-white text-sm">✓</span>}
                                                            </div>
                                                            <span className="font-semibold">{optionLetter}.</span>
                                                            <span className={isSelected ? 'text-gray-900' : ''}>{option}</span>
                                                        </div>
                                                    </button>
                                                );
                                            })}
                                        </div>

                                        <div className="flex justify-between">
                                            <button
                                                onClick={() => setCurrentQuestion(Math.max(0, currentQuestion - 1))}
                                                disabled={currentQuestion === 0}
                                                className="px-6 py-3 bg-gray-500 text-white rounded-xl font-bold hover:bg-gray-600 transition disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                ← Previous
                                            </button>

                                            {currentQuestion === questions.length - 1 ? (
                                                <button
                                                    onClick={() => setShowConfirmSubmit(true)}
                                                    className="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition"
                                                >
                                                    Submit Exam ✓
                                                </button>
                                            ) : (
                                                <button
                                                    onClick={() => setCurrentQuestion(Math.min(questions.length - 1, currentQuestion + 1))}
                                                    className="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition"
                                                >
                                                    Next →
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                <div className="space-y-6">
                                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                        <h3 className="text-lg font-bold mb-4">Progress</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <div className="flex justify-between text-sm mb-2">
                                                    <span>Answered</span>
                                                    <span className="font-bold text-green-600">{answeredCount}/{questions.length}</span>
                                                </div>
                                                <div className={`h-3 ${darkMode ? 'bg-gray-700' : 'bg-gray-200'} rounded-full overflow-hidden`}>
                                                    <div className="h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-300" style={{ width: `${(answeredCount / questions.length) * 100}%` }} />
                                                </div>
                                            </div>
                                            <div>
                                                <div className="flex justify-between text-sm mb-2">
                                                    <span>Unanswered</span>
                                                    <span className="font-bold text-orange-600">{unansweredCount}</span>
                                                </div>
                                            </div>
                                            <div>
                                                <div className="flex justify-between text-sm mb-2">
                                                    <span>Flagged</span>
                                                    <span className="font-bold text-yellow-600">{flaggedCount}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className={`${cardClass} rounded-2xl p-6 shadow-lg`}>
                                        <h3 className="text-lg font-bold mb-4">Question Navigator</h3>
                                        <div className="grid grid-cols-5 gap-2 max-h-96 overflow-y-auto">
                                            {questions.map((_, idx) => {
                                                const isAnswered = userAnswers[idx];
                                                const isFlagged = flaggedQuestions.has(idx);
                                                const isCurrent = idx === currentQuestion;

                                                return (
                                                    <button
                                                        key={idx}
                                                        onClick={() => setCurrentQuestion(idx)}
                                                        className={`aspect-square rounded-lg font-bold text-sm transition transform hover:scale-110 relative ${isCurrent
                                                            ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg'
                                                            : isAnswered
                                                                ? 'bg-green-500 text-white'
                                                                : darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-700'
                                                            }`}
                                                    >
                                                        {idx + 1}
                                                        {isFlagged && (
                                                            <div className="absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center">
                                                                <span className="text-xs">🚩</span>
                                                            </div>
                                                        )}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    <button
                                        onClick={() => setShowConfirmSubmit(true)}
                                        className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg hover:shadow-xl transform hover:scale-105 transition"
                                    >
                                        Submit Exam
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Stats Modal with Full History */}
                    {showStats && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                            <div className={`${cardClass} rounded-2xl p-8 max-w-4xl w-full shadow-2xl my-8`}>
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-2xl font-bold">Your Complete Exam History</h3>
                                    <button onClick={() => setShowStats(false)} className="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                                </div>

                                {examHistory.length > 0 ? (
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                            <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                <p className="text-sm opacity-75">Total Attempts</p>
                                                <p className="text-2xl font-bold text-blue-600">{examHistory.length}</p>
                                            </div>
                                            <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                <p className="text-sm opacity-75">Average Score</p>
                                                <p className="text-2xl font-bold text-green-600">
                                                    {(examHistory.reduce((sum, h) => sum + parseFloat(h.percentage), 0) / examHistory.length).toFixed(1)}%
                                                </p>
                                            </div>
                                            <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                <p className="text-sm opacity-75">Best Score</p>
                                                <p className="text-2xl font-bold text-purple-600">
                                                    {Math.max(...examHistory.map(h => parseFloat(h.percentage)))}%
                                                </p>
                                            </div>
                                        </div>

                                        <div className="space-y-3 max-h-96 overflow-y-auto">
                                            {examHistory.map((exam, idx) => (
                                                <div key={idx} className={`p-4 rounded-xl ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} hover:shadow-lg transition cursor-pointer`}
                                                    onClick={() => {
                                                        setSelectedHistoryExam(exam);
                                                        setShowStats(false);
                                                    }}>
                                                    <div className="flex justify-between items-center">
                                                        <div>
                                                            <h4 className="font-bold">{exam.examTitle}</h4>
                                                            <p className="text-sm opacity-75">{new Date(exam.dateCreated).toLocaleString()}</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className={`text-2xl font-bold ${parseFloat(exam.percentage) >= 70 ? 'text-green-600' : 'text-red-600'}`}>
                                                                {exam.percentage}%
                                                            </p>
                                                            <p className="text-sm">{exam.score}/{exam.totalQuestions}</p>
                                                            <p className="text-xs text-blue-600 mt-1">Click to review full exam</p>
                                                        </div>
                                                    </div>
                                                    <div className="mt-2 flex items-center space-x-4 text-sm">
                                                        <span className="flex items-center space-x-1">
                                                            <Clock />
                                                            <span>{formatTime(exam.timeSpent)}</span>
                                                        </span>
                                                        <span className={`px-3 py-1 rounded-full ${parseFloat(exam.percentage) >= 70 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                            {parseFloat(exam.percentage) >= 70 ? 'Pass ✓' : 'Fail ✗'}
                                                        </span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ) : (
                                    <p className="text-center text-gray-500 py-8">No exam history available</p>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Confirm Submit Modal */}
                    {showConfirmSubmit && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className={`${cardClass} rounded-2xl p-8 max-w-md w-full shadow-2xl transform scale-100 animate-pulse`}>
                                <div className="text-center">
                                    <div className="w-16 h-16 mx-auto mb-4 bg-yellow-100 rounded-full flex items-center justify-center">
                                        <div className="w-10 h-10 text-yellow-600"><AlertCircle /></div>
                                    </div>
                                    <h3 className="text-2xl font-bold mb-4">Confirm Submission</h3>
                                    <p className="mb-6">Are you sure you want to submit your AWS exam?</p>
                                    <div className="space-y-2 mb-6 text-left">
                                        <p className="flex justify-between">
                                            <span>Answered:</span>
                                            <span className="font-bold text-green-600">{answeredCount} questions</span>
                                        </p>
                                        <p className="flex justify-between">
                                            <span>Unanswered:</span>
                                            <span className="font-bold text-red-600">{unansweredCount} questions</span>
                                        </p>
                                        <p className="flex justify-between">
                                            <span>Flagged:</span>
                                            <span className="font-bold text-yellow-600">{flaggedCount} questions</span>
                                        </p>
                                    </div>
                                    <div className="flex space-x-4">
                                        <button
                                            onClick={() => setShowConfirmSubmit(false)}
                                            className="flex-1 px-6 py-3 bg-gray-500 text-white rounded-xl font-bold hover:bg-gray-600 transition"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={handleSubmit}
                                            className="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold hover:shadow-xl transform hover:scale-105 transition"
                                        >
                                            Submit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<ExamSystem />, document.getElementById('root'));
    </script>
</body>

</html>
